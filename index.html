<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Placement Prep | Ace Your Placement</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/recharts@2.5.0/dist/Recharts.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            DEFAULT: 'hsl(245, 58%, 51%)',
                            light: 'hsl(245, 58%, 65%)',
                            dark: 'hsl(245, 58%, 40%)',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #e0e7ff;
            border-top-color: #6366f1;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @media print {

            nav,
            .no-print,
            button,
            .template-selector,
            #debug-panel {
                display: none !important;
            }

            body {
                background: white !important;
                padding: 0 !important;
                margin: 0 !important;
            }

            #app {
                width: 100% !important;
                margin: 0 !important;
                padding: 0 !important;
            }

            .min-h-screen {
                min-height: auto !important;
            }

            .bg-slate-50,
            .bg-slate-100 {
                background-color: white !important;
            }

            .shadow-lg,
            .shadow-sm {
                box-shadow: none !important;
            }

            main {
                padding: 0 !important;
                margin: 0 !important;
            }

            .max-w-4xl {
                max-width: 100% !important;
                width: 100% !important;
            }

            div[style*="aspect-ratio: 8.5/11"] {
                aspect-ratio: auto !important;
                height: auto !important;
                padding: 0 !important;
                margin: 0 !important;
                box-shadow: none !important;
                border: none !important;
            }

            h2 {
                page-break-after: avoid;
            }

            .mb-8,
            .mb-12 {
                page-break-inside: avoid;
            }
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-900">
    <div id="app"></div>

    <script>
        // Simple router state
        let currentRoute = window.location.hash.slice(1) || '/';
        let currentAnalysis = null;

        // Test Checklist
        const testItems = [
            { id: 'jd-required', label: 'JD required validation works', hint: 'Try submitting empty JD on Analyze page' },
            { id: 'short-jd-warning', label: 'Short JD warning shows for <200 chars', hint: 'Enter JD with less than 200 characters' },
            { id: 'skills-extraction', label: 'Skills extraction groups correctly', hint: 'Analyze JD with React, Java, SQL - check if grouped properly' },
            { id: 'round-mapping', label: 'Round mapping changes based on company + skills', hint: 'Test with "Google" vs "Unknown Startup"' },
            { id: 'score-deterministic', label: 'Score calculation is deterministic', hint: 'Same JD should give same baseScore every time' },
            { id: 'skill-toggles', label: 'Skill toggles update score live', hint: 'Toggle skills and watch finalScore change' },
            { id: 'persist-refresh', label: 'Changes persist after refresh', hint: 'Toggle skills, refresh page, check if preserved' },
            { id: 'history-works', label: 'History saves and loads correctly', hint: 'Analyze JD, go to History, click entry' },
            { id: 'export-buttons', label: 'Export buttons copy the correct content', hint: 'Click "Copy 7-Day Plan" and paste in notepad' },
            { id: 'no-console-errors', label: 'No console errors on core pages', hint: 'Open DevTools Console, navigate all pages' }
        ];

        function getTestChecklist() {
            const saved = localStorage.getItem('prpTestChecklist');
            if (saved) {
                return JSON.parse(saved);
            }
            // Initialize all unchecked
            const checklist = {};
            testItems.forEach(item => {
                checklist[item.id] = false;
            });
            return checklist;
        }

        function saveTestChecklist(checklist) {
            localStorage.setItem('prpTestChecklist', JSON.stringify(checklist));
        }

        function toggleTestItem(itemId) {
            const checklist = getTestChecklist();
            checklist[itemId] = !checklist[itemId];
            saveTestChecklist(checklist);
            render();
        }

        function resetTestChecklist() {
            if (confirm('Reset all test checkboxes?')) {
                localStorage.removeItem('prpTestChecklist');
                render();
            }
        }

        function getTestsPassed() {
            const checklist = getTestChecklist();
            const total = testItems.length;
            const passed = Object.values(checklist).filter(v => v).length;
            return { passed, total };
        }

        function isShipUnlocked() {
            const { passed, total } = getTestsPassed();
            return passed === total;
        }

        // Step Tracking System
        const projectSteps = [
            { id: 'step1', label: 'Setup project structure and design system' },
            { id: 'step2', label: 'Build analysis engine with skill extraction' },
            { id: 'step3', label: 'Implement readiness scoring logic' },
            { id: 'step4', label: 'Create round mapping and company intel' },
            { id: 'step5', label: 'Add interactive skill toggles and live scoring' },
            { id: 'step6', label: 'Build history persistence and export tools' },
            { id: 'step7', label: 'Complete test checklist verification' },
            { id: 'step8', label: 'Deploy and submit final artifacts' }
        ];

        function getStepCompletion() {
            const saved = localStorage.getItem('prpStepCompletion');
            if (saved) {
                return JSON.parse(saved);
            }
            const completion = {};
            projectSteps.forEach(step => {
                completion[step.id] = false;
            });
            return completion;
        }

        function saveStepCompletion(completion) {
            localStorage.setItem('prpStepCompletion', JSON.stringify(completion));
        }

        function toggleStep(stepId) {
            const completion = getStepCompletion();
            completion[stepId] = !completion[stepId];
            saveStepCompletion(completion);
            render();
        }

        function getStepsCompleted() {
            const completion = getStepCompletion();
            const total = projectSteps.length;
            const completed = Object.values(completion).filter(v => v).length;
            return { completed, total };
        }

        // Artifact Submission
        function getSubmission() {
            const saved = localStorage.getItem('prp_final_submission');
            if (saved) {
                return JSON.parse(saved);
            }
            return {
                lovableLink: '',
                githubLink: '',
                deployedLink: ''
            };
        }

        function saveSubmission(submission) {
            localStorage.setItem('prp_final_submission', JSON.stringify(submission));
        }

        function isValidURL(url) {
            if (!url || url.trim() === '') return false;
            try {
                new URL(url);
                return true;
            } catch {
                return false;
            }
        }

        function updateSubmissionField(field, value) {
            const submission = getSubmission();
            submission[field] = value;
            saveSubmission(submission);
        }

        function areAllLinksProvided() {
            const submission = getSubmission();
            return isValidURL(submission.lovableLink) &&
                isValidURL(submission.githubLink) &&
                isValidURL(submission.deployedLink);
        }

        function copyFinalSubmission() {
            const submission = getSubmission();
            const text = `------------------------------------------
Placement Readiness Platform — Final Submission

Lovable Project: ${submission.lovableLink}
GitHub Repository: ${submission.githubLink}
Live Deployment: ${submission.deployedLink}

Core Capabilities:
- JD skill extraction (deterministic)
- Round mapping engine
- 7-day prep plan
- Interactive readiness scoring
- History persistence
------------------------------------------`;

            navigator.clipboard.writeText(text).then(() => {
                alert('Final submission copied to clipboard!');
            });
        }

        function isProjectShipped() {
            const { completed, total } = getStepsCompleted();
            const allStepsComplete = completed === total;
            const allTestsPassed = isShipUnlocked();
            const allLinksProvided = areAllLinksProvided();

            return allStepsComplete && allTestsPassed && allLinksProvided;
        }

        // Analysis Engine
        const skillCategories = {
            'Core CS': ['DSA', 'OOP', 'DBMS', 'OS', 'Networks', 'Operating System', 'Data Structures', 'Algorithms'],
            'Languages': ['Java', 'Python', 'JavaScript', 'TypeScript', 'C++', 'C#', 'Go', 'Rust', 'Kotlin'],
            'Web': ['React', 'Next.js', 'Node.js', 'Express', 'REST', 'GraphQL', 'Angular', 'Vue', 'HTML', 'CSS'],
            'Data': ['SQL', 'MongoDB', 'PostgreSQL', 'MySQL', 'Redis', 'NoSQL', 'Database'],
            'Cloud/DevOps': ['AWS', 'Azure', 'GCP', 'Docker', 'Kubernetes', 'CI/CD', 'Linux', 'Jenkins', 'Git'],
            'Testing': ['Selenium', 'Cypress', 'Playwright', 'JUnit', 'PyTest', 'Jest', 'Testing']
        };

        function extractSkills(jdText) {
            const text = jdText.toLowerCase();
            const extracted = {};

            Object.keys(skillCategories).forEach(category => {
                const found = skillCategories[category].filter(skill =>
                    text.includes(skill.toLowerCase())
                );
                if (found.length > 0) {
                    extracted[category] = [...new Set(found)];
                }
            });

            // If no skills detected, return default general skills
            if (Object.keys(extracted).length === 0) {
                extracted['Other'] = ['Communication', 'Problem solving', 'Basic coding', 'Projects'];
            }

            return extracted;
        }

        function calculateReadiness(skills, company, role, jdLength) {
            let score = 35;
            score += Object.keys(skills).length * 5;
            if (company && company.trim()) score += 10;
            if (role && role.trim()) score += 10;
            if (jdLength > 800) score += 10;
            return Math.min(score, 100);
        }

        function generateChecklist(skills) {
            const hasSkill = (cat) => skills[cat] && skills[cat].length > 0;

            return {
                'Round 1: Aptitude & Basics': [
                    'Practice quantitative aptitude (numbers, percentages)',
                    'Solve logical reasoning puzzles',
                    'Review verbal ability and comprehension',
                    'Practice time management for MCQ tests',
                    'Revise basic mathematics and statistics'
                ],
                'Round 2: DSA & Core CS': [
                    hasSkill('Core CS') ? 'Revise DSA: arrays, strings, linked lists, trees' : 'Study basic data structures',
                    hasSkill('Core CS') ? 'Practice sorting and searching algorithms' : 'Learn algorithm basics',
                    'Review OOP concepts: inheritance, polymorphism, encapsulation',
                    'Study DBMS: normalization, indexing, transactions',
                    'Revise OS: processes, threads, memory management',
                    hasSkill('Core CS') ? 'Practice coding problems on LeetCode/HackerRank' : 'Start with easy coding problems'
                ],
                'Round 3: Technical Interview': [
                    hasSkill('Web') ? `Prepare ${skills['Web'].join(', ')} concepts` : 'Review your tech stack',
                    hasSkill('Languages') ? `Practice coding in ${skills['Languages'][0]}` : 'Practice your primary language',
                    'Prepare to explain your projects in detail',
                    hasSkill('Data') ? 'Review database design and query optimization' : 'Study basic SQL queries',
                    hasSkill('Cloud/DevOps') ? `Revise ${skills['Cloud/DevOps'].join(', ')}` : 'Learn basic Git commands',
                    'Prepare system design basics (if asked)'
                ],
                'Round 4: Managerial & HR': [
                    'Prepare "Tell me about yourself" answer',
                    'List your strengths and weaknesses with examples',
                    'Prepare STAR method answers for behavioral questions',
                    'Research the company culture and values',
                    'Prepare questions to ask the interviewer',
                    'Practice explaining why you want this role'
                ]
            };
        }

        function generate7DayPlan(skills) {
            const hasSkill = (cat) => skills[cat] && skills[cat].length > 0;

            return {
                'Day 1-2: Basics & Core CS': [
                    'Revise OOP, DBMS, OS fundamentals',
                    hasSkill('Core CS') ? 'Practice 5-10 easy DSA problems' : 'Learn basic data structures',
                    'Review your resume and projects',
                    'Prepare project explanations'
                ],
                'Day 3-4: DSA & Coding': [
                    'Solve 10-15 medium DSA problems',
                    hasSkill('Languages') ? `Practice ${skills['Languages'][0]} syntax` : 'Practice your primary language',
                    'Focus on arrays, strings, and hashmaps',
                    'Time yourself while solving'
                ],
                'Day 5: Projects & Stack': [
                    hasSkill('Web') ? `Revise ${skills['Web'].slice(0, 2).join(', ')} concepts` : 'Review your tech stack',
                    'Prepare detailed project walkthroughs',
                    hasSkill('Data') ? 'Practice SQL queries and database design' : 'Learn basic SQL',
                    'Update your resume with quantifiable achievements'
                ],
                'Day 6: Mock Interviews': [
                    'Practice behavioral questions with STAR method',
                    'Do a mock technical interview with a friend',
                    'Record yourself answering common questions',
                    'Review and improve your communication'
                ],
                'Day 7: Revision & Weak Areas': [
                    'Revisit topics you struggled with',
                    'Solve 5 problems from weak areas',
                    'Review company-specific information',
                    'Prepare questions for the interviewer',
                    'Get a good night\'s sleep'
                ]
            };
        }

        function generateQuestions(skills) {
            const questions = [];
            const hasSkill = (cat) => skills[cat] && skills[cat].length > 0;

            if (hasSkill('Core CS')) {
                questions.push(
                    'Explain the difference between stack and heap memory.',
                    'How would you optimize search in sorted data?',
                    'What is the time complexity of common sorting algorithms?'
                );
            }

            if (hasSkill('Languages')) {
                const lang = skills['Languages'][0];
                questions.push(
                    `Explain key features of ${lang}.`,
                    `What are the differences between ${lang} and other languages you know?`
                );
            }

            if (hasSkill('Web')) {
                if (skills['Web'].some(s => s.toLowerCase().includes('react'))) {
                    questions.push(
                        'Explain state management options in React.',
                        'What are React hooks and when would you use them?'
                    );
                }
                questions.push('Explain the difference between REST and GraphQL.');
            }

            if (hasSkill('Data')) {
                questions.push(
                    'Explain indexing and when it helps performance.',
                    'What is database normalization and why is it important?'
                );
            }

            if (hasSkill('Cloud/DevOps')) {
                questions.push(
                    'Explain the benefits of containerization with Docker.',
                    'What is CI/CD and why is it important?'
                );
            }

            // Fill remaining with general questions
            const general = [
                'Walk me through your most challenging project.',
                'How do you handle debugging complex issues?',
                'Explain a time you optimized code performance.',
                'How do you stay updated with new technologies?',
                'Describe your development workflow.'
            ];

            while (questions.length < 10) {
                questions.push(general[questions.length % general.length]);
            }

            return questions.slice(0, 10);
        }

        function saveToHistory(analysis) {
            const history = JSON.parse(localStorage.getItem('placementHistory') || '[]');
            history.unshift(analysis);
            localStorage.setItem('placementHistory', JSON.stringify(history.slice(0, 20)));
        }

        function getHistory() {
            try {
                const history = JSON.parse(localStorage.getItem('placementHistory') || '[]');
                // Filter out any corrupted entries
                return history.filter(entry => {
                    return entry && entry.id && entry.jdText && entry.extractedSkills;
                });
            } catch (error) {
                console.error('localStorage corrupted:', error);
                // Clear corrupted data
                localStorage.removeItem('placementHistory');
                return [];
            }
        }

        function analyzeJD(company, role, jdText) {
            const skills = extractSkills(jdText);
            const readinessScore = calculateReadiness(skills, company, role, jdText.length);
            const checklist = generateChecklist(skills);
            const plan = generate7DayPlan(skills);
            const questions = generateQuestions(skills);

            // Initialize skill confidence map (all default to "practice")
            const skillConfidenceMap = {};
            Object.values(skills).flat().forEach(skill => {
                skillConfidenceMap[skill] = 'practice';
            });

            // Generate company intel
            const companyIntel = generateCompanyIntel(company, jdText);

            // Generate round mapping
            const roundMapping = generateRoundMapping(companyIntel.size, skills);

            const analysis = {
                id: Date.now().toString(),
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                company: company || '',
                role: role || '',
                jdText,
                extractedSkills: skills,
                roundMapping,
                checklist,
                plan7Days: plan,
                questions,
                baseScore: readinessScore,
                skillConfidenceMap,
                finalScore: readinessScore,
                companyIntel
            };

            saveToHistory(analysis);
            currentAnalysis = analysis;

            return analysis;
        }

        // Company Intel Generation
        function generateCompanyIntel(companyName, jdText) {
            const text = jdText.toLowerCase();

            // Known enterprise companies
            const enterpriseCompanies = [
                'google', 'microsoft', 'amazon', 'meta', 'facebook', 'apple', 'netflix',
                'infosys', 'tcs', 'wipro', 'cognizant', 'accenture', 'deloitte', 'ibm',
                'oracle', 'salesforce', 'adobe', 'intel', 'nvidia', 'cisco', 'sap',
                'jpmorgan', 'goldman sachs', 'morgan stanley', 'wells fargo'
            ];

            // Determine company size
            let size = 'Startup';
            const companyLower = companyName.toLowerCase();

            if (enterpriseCompanies.some(e => companyLower.includes(e))) {
                size = 'Enterprise';
            } else if (text.includes('multinational') || text.includes('fortune') || text.includes('global')) {
                size = 'Enterprise';
            } else if (text.includes('mid-size') || text.includes('established')) {
                size = 'Mid-size';
            }

            // Infer industry
            let industry = 'Technology Services';
            if (text.includes('fintech') || text.includes('banking') || text.includes('financial')) {
                industry = 'Financial Technology';
            } else if (text.includes('ecommerce') || text.includes('e-commerce') || text.includes('retail')) {
                industry = 'E-commerce & Retail';
            } else if (text.includes('healthcare') || text.includes('medical')) {
                industry = 'Healthcare Technology';
            } else if (text.includes('edtech') || text.includes('education')) {
                industry = 'Education Technology';
            } else if (text.includes('saas') || text.includes('cloud')) {
                industry = 'Cloud & SaaS';
            } else if (text.includes('consulting')) {
                industry = 'IT Consulting';
            }

            // Hiring focus based on size
            let hiringFocus = [];
            if (size === 'Enterprise') {
                hiringFocus = [
                    'Strong DSA fundamentals and problem-solving',
                    'Core CS concepts (OS, DBMS, Networks)',
                    'System design and scalability thinking',
                    'Clean code and best practices'
                ];
            } else if (size === 'Mid-size') {
                hiringFocus = [
                    'Balanced DSA and practical coding',
                    'Hands-on experience with tech stack',
                    'Project ownership and delivery',
                    'Team collaboration skills'
                ];
            } else {
                hiringFocus = [
                    'Practical problem-solving ability',
                    'Deep knowledge of relevant stack',
                    'Ability to ship features quickly',
                    'Adaptability and learning mindset'
                ];
            }

            return {
                size,
                industry,
                hiringFocus
            };
        }

        // Round Mapping Generation
        function generateRoundMapping(companySize, skills) {
            const hasSkill = (cat) => skills[cat] && skills[cat].length > 0;
            const hasDSA = hasSkill('Core CS');
            const hasWeb = hasSkill('Web');

            let rounds = [];

            if (companySize === 'Enterprise') {
                rounds = [
                    {
                        name: 'Round 1: Online Assessment',
                        description: 'DSA coding + Aptitude + MCQs',
                        why: 'Tests fundamental problem-solving and CS knowledge at scale'
                    },
                    {
                        name: 'Round 2: Technical Interview I',
                        description: 'DSA deep-dive + Core CS concepts',
                        why: 'Evaluates coding proficiency and theoretical understanding'
                    },
                    {
                        name: 'Round 3: Technical Interview II',
                        description: 'System design + Projects discussion',
                        why: 'Assesses scalability thinking and practical experience'
                    },
                    {
                        name: 'Round 4: HR & Behavioral',
                        description: 'Culture fit + Situational questions',
                        why: 'Ensures alignment with company values and team dynamics'
                    }
                ];
            } else if (companySize === 'Mid-size') {
                rounds = [
                    {
                        name: 'Round 1: Screening',
                        description: hasDSA ? 'Coding test + Technical MCQs' : 'Technical assessment',
                        why: 'Filters candidates based on baseline technical skills'
                    },
                    {
                        name: 'Round 2: Technical Round',
                        description: hasWeb ? 'Stack-specific coding + DSA' : 'DSA + Core CS',
                        why: 'Validates hands-on coding ability and problem-solving'
                    },
                    {
                        name: 'Round 3: Project Discussion',
                        description: 'Deep-dive into past projects',
                        why: 'Understands real-world experience and ownership'
                    },
                    {
                        name: 'Round 4: Final Round',
                        description: 'Manager interview + Culture fit',
                        why: 'Confirms team compatibility and role expectations'
                    }
                ];
            } else {
                // Startup
                rounds = [
                    {
                        name: 'Round 1: Practical Coding',
                        description: hasWeb ? 'Build a feature or solve real problem' : 'Coding challenge',
                        why: 'Tests ability to ship working code quickly'
                    },
                    {
                        name: 'Round 2: Technical Discussion',
                        description: 'Stack deep-dive + Architecture chat',
                        why: 'Evaluates depth of knowledge in relevant technologies'
                    },
                    {
                        name: 'Round 3: Culture Fit',
                        description: 'Founder/Team chat + Values alignment',
                        why: 'Ensures you thrive in fast-paced startup environment'
                    }
                ];
            }

            return rounds;
        }

        // Interactive features
        function toggleSkillConfidence(skill) {
            if (!currentAnalysis) return;

            const current = currentAnalysis.skillConfidenceMap[skill];
            currentAnalysis.skillConfidenceMap[skill] = current === 'know' ? 'practice' : 'know';

            // Recalculate readiness score
            updateReadinessScore();

            // Update timestamp
            currentAnalysis.updatedAt = new Date().toISOString();

            // Save to localStorage
            updateHistoryEntry(currentAnalysis);

            // Re-render
            render();
        }

        function updateReadinessScore() {
            if (!currentAnalysis) return;

            let score = currentAnalysis.baseScore;

            Object.entries(currentAnalysis.skillConfidenceMap).forEach(([skill, confidence]) => {
                if (confidence === 'know') {
                    score += 2;
                } else {
                    score -= 2;
                }
            });

            currentAnalysis.finalScore = Math.max(0, Math.min(100, score));
        }

        function updateHistoryEntry(analysis) {
            const history = getHistory();
            const index = history.findIndex(item => item.id === analysis.id);
            if (index !== -1) {
                history[index] = analysis;
                localStorage.setItem('placementHistory', JSON.stringify(history));
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Copied to clipboard!');
            });
        }

        function export7DayPlan() {
            if (!currentAnalysis) return;
            let text = '7-DAY PREPARATION PLAN\n\n';
            const plan = currentAnalysis.plan7Days || currentAnalysis.plan || {};
            Object.entries(plan).forEach(([day, tasks]) => {
                text += `${day}\n`;
                tasks.forEach(task => text += `  • ${task}\n`);
                text += '\n';
            });
            copyToClipboard(text);
        }

        function exportChecklist() {
            if (!currentAnalysis) return;
            let text = 'ROUND-WISE PREPARATION CHECKLIST\n\n';
            Object.entries(currentAnalysis.checklist).forEach(([round, items]) => {
                text += `${round}\n`;
                items.forEach(item => text += `  • ${item}\n`);
                text += '\n';
            });
            copyToClipboard(text);
        }

        function exportQuestions() {
            if (!currentAnalysis) return;
            let text = '10 LIKELY INTERVIEW QUESTIONS\n\n';
            currentAnalysis.questions.forEach((q, i) => {
                text += `${i + 1}. ${q}\n`;
            });
            copyToClipboard(text);
        }

        function downloadTXT() {
            if (!currentAnalysis) return;

            let content = `PLACEMENT READINESS ANALYSIS\n`;
            content += `Company: ${currentAnalysis.company || 'N/A'}\n`;
            content += `Role: ${currentAnalysis.role || 'N/A'}\n`;
            content += `Readiness Score: ${currentAnalysis.finalScore || currentAnalysis.readinessScore || 0}/100\n`;
            content += `Date: ${new Date(currentAnalysis.createdAt).toLocaleDateString()}\n\n`;
            content += `${'='.repeat(60)}\n\n`;

            content += `EXTRACTED SKILLS\n\n`;
            Object.entries(currentAnalysis.extractedSkills).forEach(([category, skills]) => {
                content += `${category}: ${skills.join(', ')}\n`;
            });
            content += `\n${'='.repeat(60)}\n\n`;

            content += `7-DAY PREPARATION PLAN\n\n`;
            const plan = currentAnalysis.plan7Days || currentAnalysis.plan || {};
            Object.entries(plan).forEach(([day, tasks]) => {
                content += `${day}\n`;
                tasks.forEach(task => content += `  • ${task}\n`);
                content += '\n';
            });
            content += `${'='.repeat(60)}\n\n`;

            content += `ROUND-WISE CHECKLIST\n\n`;
            Object.entries(currentAnalysis.checklist).forEach(([round, items]) => {
                content += `${round}\n`;
                items.forEach(item => content += `  • ${item}\n`);
                content += '\n';
            });
            content += `${'='.repeat(60)}\n\n`;

            content += `10 LIKELY INTERVIEW QUESTIONS\n\n`;
            currentAnalysis.questions.forEach((q, i) => {
                content += `${i + 1}. ${q}\n`;
            });

            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentAnalysis.company}_${currentAnalysis.role}_Analysis.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Icon component (simple SVG)
        function Icon(name, size = 20) {
            const icons = {
                'layout': `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></svg>`,
                'code': `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>`,
                'video': `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="23 7 16 12 23 17 23 7"/><rect x="1" y="5" width="15" height="14" rx="2" ry="2"/></svg>`,
                'bar-chart-3': `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="20" x2="12" y2="10"/><line x1="18" y1="20" x2="18" y2="4"/><line x1="6" y1="20" x2="6" y2="16"/></svg>`,
                'layout-dashboard': `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="9"/><rect x="14" y="3" width="7" height="5"/><rect x="14" y="12" width="7" height="9"/><rect x="3" y="16" width="7" height="5"/></svg>`,
                'code-2': `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>`,
                'clipboard-check': `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><polyline points="9 14 11 16 15 12"/></svg>`,
                'library': `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>`,
                'user': `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>`,
                'log-out': `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>`,
                'bell': `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>`,
                'construction': `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="6" width="20" height="8" rx="1"/><path d="M17 14v7"/><path d="M7 14v7"/><path d="M17 3v3"/><path d="M7 3v3"/><path d="M10 14 2.3 6.3"/><path d="m14 6 7.7 7.7"/><path d="m8 6 8 8"/></svg>`,
                'search': `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>`,
                'clock': `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>`
            };
            return icons[name] || '';
        }

        // Landing Page
        function renderLanding() {
            return `
                <div class="min-h-screen flex flex-col bg-white text-slate-900">
                    <nav class="flex items-center justify-between px-8 py-4 border-b border-slate-100">
                        <div class="flex items-center gap-2">
                            ${Icon('layout')}
                            <span class="text-xl font-bold">Placement Prep</span>
                        </div>
                        <div class="flex items-center gap-6 text-sm font-medium">
                            <a href="#" class="text-slate-600 hover:text-primary transition-colors">Features</a>
                            <a href="#" class="text-slate-600 hover:text-primary transition-colors">About</a>
                            <button onclick="navigate('/dashboard')" class="bg-primary text-white px-6 py-2 rounded-full hover:bg-primary-dark transition-all shadow-md">
                                Login
                            </button>
                        </div>
                    </nav>

                    <header class="flex-1 flex flex-col items-center justify-center text-center px-4 py-20 bg-gradient-to-b from-indigo-50/50 to-white">
                        <div class="inline-block px-4 py-1.5 mb-6 text-sm font-bold tracking-wide text-primary uppercase bg-indigo-100/50 rounded-full">
                            Your Career Starts Here
                        </div>
                        <h1 class="text-5xl md:text-7xl font-extrabold mb-6 tracking-tight">
                            Ace Your <span class="text-primary">Placement</span>
                        </h1>
                        <p class="text-xl text-slate-600 max-w-2xl mb-10 leading-relaxed">
                            Practice, assess, and prepare for your dream job with our comprehensive placement readiness platform.
                        </p>
                        <button onclick="navigate('/dashboard')" class="bg-primary text-white px-10 py-4 rounded-full text-lg font-bold hover:bg-primary-dark transition-all hover:scale-105 shadow-xl shadow-primary/30 active:scale-95">
                            Get Started
                        </button>
                    </header>

                    <section class="py-24 px-8 bg-slate-50/50">
                        <div class="max-w-6xl mx-auto grid md:grid-cols-3 gap-8">
                            <div class="bg-white p-8 rounded-2xl border border-slate-100 shadow-sm hover:shadow-md transition-all">
                                <div class="w-12 h-12 bg-indigo-100 text-primary rounded-xl flex items-center justify-center mb-6">
                                    ${Icon('code', 24)}
                                </div>
                                <h3 class="text-xl font-bold mb-2">Practice Problems</h3>
                                <p class="text-slate-500">Master coding challenges and system design concepts with real-time feedback.</p>
                            </div>
                            <div class="bg-white p-8 rounded-2xl border border-slate-100 shadow-sm hover:shadow-md transition-all">
                                <div class="w-12 h-12 bg-purple-100 text-purple-600 rounded-xl flex items-center justify-center mb-6">
                                    ${Icon('video', 24)}
                                </div>
                                <h3 class="text-xl font-bold mb-2">Mock Interviews</h3>
                                <p class="text-slate-500">Prepare for behavioral and technical rounds with interactive simulation sessions.</p>
                            </div>
                            <div class="bg-white p-8 rounded-2xl border border-slate-100 shadow-sm hover:shadow-md transition-all">
                                <div class="w-12 h-12 bg-blue-100 text-blue-600 rounded-xl flex items-center justify-center mb-6">
                                    ${Icon('bar-chart-3', 24)}
                                </div>
                                <h3 class="text-xl font-bold mb-2">Track Progress</h3>
                                <p class="text-slate-500">Analyze your performance metrics and readiness levels with advanced data insights.</p>
                            </div>
                        </div>
                    </section>

                    <footer class="py-12 border-t border-slate-100 text-center text-slate-400 text-xs font-medium">
                        <p>© 2026 Placement Prep. All rights reserved.</p>
                    </footer>
                </div>
            `;
        }

        // Dashboard Layout
        function renderDashboard() {
            const routes = {
                '/dashboard': { title: 'Dashboard', desc: 'Your personalized placement preparation dashboard.' },
                '/dashboard/practice': { title: 'Practice', desc: 'Solve coding problems and improve your skills.' },
                '/dashboard/assessments': { title: 'Assessments', desc: 'Take mock tests and evaluate your readiness.' },
                '/dashboard/resources': { title: 'Resources', desc: 'Access study materials and preparation guides.' },
                '/dashboard/profile': { title: 'Profile', desc: 'Manage your account and track your progress.' }
            };

            const current = routes[currentRoute] || routes['/dashboard'];

            return `
                <div class="flex h-screen bg-slate-50 overflow-hidden text-slate-900">
                    <aside class="w-64 bg-white border-r border-slate-200 flex flex-col shrink-0">
                        <div class="p-6 border-b border-slate-200">
                            <h2 class="text-xl font-bold text-primary flex items-center gap-2">
                                ${Icon('layout')}
                                Placement Prep
                            </h2>
                        </div>
                        <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
                            ${navLink('/dashboard', 'layout-dashboard', 'Dashboard')}
                            ${navLink('/dashboard/analyze', 'search', 'Analyze JD')}
                            ${navLink('/dashboard/practice', 'code-2', 'Practice')}
                            ${navLink('/dashboard/assessments', 'clipboard-check', 'Assessments')}
                            ${navLink('/dashboard/history', 'clock', 'History')}
                            ${navLink('/dashboard/test', 'check-square', 'Test Checklist')}
                            ${navLink('/dashboard/proof', 'award', 'Proof')}
                            ${navLink('/dashboard/ship', 'package', 'Ship')}
                            ${navLink('/dashboard/profile', 'user', 'Profile')}
                        </nav>
                        <div class="p-4 border-t border-slate-200">
                            <a href="#/" class="flex items-center gap-3 px-3 py-2 text-slate-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors">
                                ${Icon('log-out')}
                                <span class="font-medium">Sign Out</span>
                            </a>
                        </div>
                    </aside>

                    <div class="flex-1 flex flex-col h-full overflow-hidden">
                        <header class="h-16 bg-white border-b border-slate-200 flex items-center justify-between px-8 shrink-0">
                            <h1 class="text-lg font-semibold text-slate-700">Placement Prep</h1>
                            <div class="flex items-center gap-4">
                                <button class="p-2 text-slate-500 hover:bg-slate-100 rounded-full transition-colors relative">
                                    ${Icon('bell')}
                                    <span class="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full border-2 border-white"></span>
                                </button>
                                <div class="flex items-center gap-3 pl-4 border-l border-slate-200">
                                    <div class="text-right">
                                        <p class="text-sm font-medium">Student</p>
                                        <p class="text-xs text-slate-500">Candidate</p>
                                    </div>
                                    <div class="w-10 h-10 rounded-full bg-primary/10 border-2 border-primary/20 flex items-center justify-center">
                                        ${Icon('user')}
                                    </div>
                                </div>
                            </div>
                        </header>

                        <main class="flex-1 overflow-y-auto p-8">
                            ${renderDashboardContent()}
                        </main>
                    </div>
                </div>
            `;
        }

        // Dashboard Content
        function renderDashboardContent() {
            if (currentRoute === '/dashboard') {
                return `
                    <div class="max-w-7xl mx-auto">
                        <h2 class="text-3xl font-bold text-slate-900 mb-8">Dashboard</h2>
                        
                        <!-- Grid Layout -->
                        <div class="grid md:grid-cols-2 gap-6">
                            
                            <!-- Overall Readiness -->
                            <div class="bg-white rounded-xl border border-slate-200 shadow-sm p-6">
                                <h3 class="text-lg font-bold text-slate-900 mb-6">Overall Readiness</h3>
                                <div class="flex flex-col items-center justify-center py-8">
                                    <div class="relative w-48 h-48">
                                        <svg class="w-full h-full transform -rotate-90">
                                            <circle cx="96" cy="96" r="88" stroke="#e0e7ff" stroke-width="12" fill="none"/>
                                            <circle cx="96" cy="96" r="88" stroke="hsl(245, 58%, 51%)" stroke-width="12" fill="none"
                                                stroke-dasharray="553" stroke-dashoffset="154" stroke-linecap="round"
                                                class="transition-all duration-1000"/>
                                        </svg>
                                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                                            <span class="text-5xl font-bold text-primary">72</span>
                                            <span class="text-slate-400 text-sm">/100</span>
                                        </div>
                                    </div>
                                    <p class="mt-4 text-slate-600 font-medium">Readiness Score</p>
                                </div>
                            </div>
                            
                            <!-- Skill Breakdown -->
                            <div class="bg-white rounded-xl border border-slate-200 shadow-sm p-6">
                                <h3 class="text-lg font-bold text-slate-900 mb-6">Skill Breakdown</h3>
                                <div id="radar-chart" class="flex items-center justify-center h-64"></div>
                            </div>
                            
                            <!-- Continue Practice -->
                            <div class="bg-white rounded-xl border border-slate-200 shadow-sm p-6">
                                <h3 class="text-lg font-bold text-slate-900 mb-4">Continue Practice</h3>
                                <div class="flex items-start gap-4 mb-4">
                                    <div class="w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center shrink-0">
                                        ${Icon('code-2', 24)}
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-bold text-slate-900 mb-1">Dynamic Programming</h4>
                                        <p class="text-sm text-slate-500 mb-3">3 of 10 problems completed</p>
                                        <div class="w-full bg-slate-100 rounded-full h-2 mb-4">
                                            <div class="bg-primary h-2 rounded-full transition-all" style="width: 30%"></div>
                                        </div>
                                        <button onclick="navigate('/dashboard/practice')" class="bg-primary text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-primary-dark transition-colors">
                                            Continue
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Weekly Goals -->
                            <div class="bg-white rounded-xl border border-slate-200 shadow-sm p-6">
                                <h3 class="text-lg font-bold text-slate-900 mb-4">Weekly Goals</h3>
                                <div class="mb-6">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-medium text-slate-700">Problems Solved</span>
                                        <span class="text-sm font-bold text-primary">12/20</span>
                                    </div>
                                    <div class="w-full bg-slate-100 rounded-full h-2">
                                        <div class="bg-primary h-2 rounded-full transition-all" style="width: 60%"></div>
                                    </div>
                                </div>
                                <div class="flex justify-between gap-2">
                                    ${['M', 'T', 'W', 'T', 'F', 'S', 'S'].map((day, i) => `
                                        <div class="flex flex-col items-center gap-1">
                                            <div class="w-10 h-10 rounded-full flex items-center justify-center text-xs font-medium ${i < 4 ? 'bg-primary text-white' : 'bg-slate-100 text-slate-400'}">
                                                ${day}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <!-- Upcoming Assessments -->
                            <div class="bg-white rounded-xl border border-slate-200 shadow-sm p-6 md:col-span-2">
                                <h3 class="text-lg font-bold text-slate-900 mb-4">Upcoming Assessments</h3>
                                <div class="space-y-3">
                                    ${[
                        { title: 'DSA Mock Test', time: 'Tomorrow, 10:00 AM', icon: 'clipboard-check', color: 'bg-blue-100 text-blue-600' },
                        { title: 'System Design Review', time: 'Wed, 2:00 PM', icon: 'layout', color: 'bg-purple-100 text-purple-600' },
                        { title: 'HR Interview Prep', time: 'Friday, 11:00 AM', icon: 'user', color: 'bg-green-100 text-green-600' }
                    ].map(assessment => `
                                        <div class="flex items-center gap-4 p-4 border border-slate-200 rounded-lg hover:border-primary transition-colors">
                                            <div class="w-10 h-10 ${assessment.color} rounded-lg flex items-center justify-center shrink-0">
                                                ${Icon(assessment.icon, 20)}
                                            </div>
                                            <div class="flex-1">
                                                <h4 class="font-bold text-slate-900">${assessment.title}</h4>
                                                <p class="text-sm text-slate-500">${assessment.time}</p>
                                            </div>
                                            <button class="text-primary hover:text-primary-dark font-medium text-sm">
                                                View Details
                                            </button>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                        </div>
                    </div>
                `;
            } else if (currentRoute === '/dashboard/analyze') {
                return `
                    <div class="max-w-4xl mx-auto">
                        <h2 class="text-3xl font-bold text-slate-900 mb-2">Analyze Job Description</h2>
                        <p class="text-slate-500 mb-8">Get personalized preparation insights based on the JD</p>
                        
                        <div class="bg-white rounded-xl border border-slate-200 shadow-sm p-8">
                            <form id="analyze-form" onsubmit="handleAnalyze(event)">
                                <div class="space-y-6">
                                    <div>
                                        <label class="block text-sm font-medium text-slate-700 mb-2">Company Name</label>
                                        <input type="text" id="company-input" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="e.g., Google, Microsoft">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-slate-700 mb-2">Role</label>
                                        <input type="text" id="role-input" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="e.g., Software Engineer, Data Analyst">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-slate-700 mb-2">Job Description *</label>
                                        <textarea id="jd-input" required rows="10" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="Paste the complete job description here..."></textarea>
                                    </div>
                                    <button type="submit" class="w-full bg-primary text-white px-6 py-3 rounded-lg font-medium hover:bg-primary-dark transition-colors">
                                        Analyze & Generate Plan
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
            } else if (currentRoute === '/dashboard/history') {
                const history = getHistory();
                return `
                    <div class="max-w-6xl mx-auto">
                        <h2 class="text-3xl font-bold text-slate-900 mb-8">Analysis History</h2>
                        ${history.length === 0 ? `
                            <div class="bg-white rounded-xl border border-slate-200 shadow-sm p-12 text-center">
                                ${Icon('clock', 48)}
                                <p class="mt-4 text-slate-500">No analysis history yet. Start by analyzing a job description!</p>
                                <button onclick="navigate('/dashboard/analyze')" class="mt-6 bg-primary text-white px-6 py-2 rounded-lg font-medium hover:bg-primary-dark transition-colors">
                                    Analyze JD
                                </button>
                            </div>
                        ` : `
                            <div class="grid gap-4">
                                ${history.map(item => `
                                    <div onclick="viewAnalysis('${item.id}')" class="bg-white rounded-xl border border-slate-200 shadow-sm p-6 hover:border-primary transition-colors cursor-pointer">
                                        <div class="flex items-center justify-between">
                                            <div class="flex-1">
                                                <h3 class="text-lg font-bold text-slate-900">${item.company} - ${item.role}</h3>
                                                <p class="text-sm text-slate-500 mt-1">${new Date(item.createdAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric', hour: '2-digit', minute: '2-digit' })}</p>
                                            </div>
                                            <div class="flex items-center gap-4">
                                                <div class="text-right">
                                                    <p class="text-2xl font-bold text-primary">${item.readinessScore}</p>
                                                    <p class="text-xs text-slate-500">Readiness</p>
                                                </div>
                                                <div class="text-primary">
                                                    ${Icon('search', 24)}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        `}
                    </div>
                `;
            } else if (currentRoute === '/dashboard/test') {
                const checklist = getTestChecklist();
                const { passed, total } = getTestsPassed();

                return `
                    <div class="max-w-4xl mx-auto">
                        <h2 class="text-3xl font-bold text-slate-900 mb-2">Test Checklist</h2>
                        <p class="text-slate-500 mb-8">Verify all features before shipping</p>
                        
                        <!-- Summary -->
                        <div class="bg-white rounded-xl border border-slate-200 shadow-sm p-6 mb-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-2xl font-bold text-slate-900">Tests Passed: ${passed} / ${total}</p>
                                    ${passed < total ? `
                                        <p class="text-sm text-orange-600 mt-1">⚠️ Fix issues before shipping.</p>
                                    ` : `
                                        <p class="text-sm text-green-600 mt-1">✅ All tests passed! Ready to ship.</p>
                                    `}
                                </div>
                                <button onclick="resetTestChecklist()" class="px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors text-sm font-medium">
                                    Reset Checklist
                                </button>
                            </div>
                        </div>
                        
                        <!-- Checklist Items -->
                        <div class="bg-white rounded-xl border border-slate-200 shadow-sm p-6">
                            <div class="space-y-4">
                                ${testItems.map(item => `
                                    <div class="flex items-start gap-4 p-4 rounded-lg hover:bg-slate-50 transition-colors">
                                        <input 
                                            type="checkbox" 
                                            id="${item.id}" 
                                            ${checklist[item.id] ? 'checked' : ''}
                                            onchange="toggleTestItem('${item.id}')"
                                            class="mt-1 w-5 h-5 text-primary border-slate-300 rounded focus:ring-2 focus:ring-primary cursor-pointer"
                                        >
                                        <div class="flex-1">
                                            <label for="${item.id}" class="font-medium text-slate-900 cursor-pointer block">
                                                ${item.label}
                                            </label>
                                            <p class="text-sm text-slate-500 mt-1">
                                                <span class="font-medium">How to test:</span> ${item.hint}
                                            </p>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentRoute === '/dashboard/proof') {
                const stepCompletion = getStepCompletion();
                const { completed, total } = getStepsCompleted();
                const submission = getSubmission();
                const allLinksValid = areAllLinksProvided();
                const shipped = isProjectShipped();

                return `
                    <div class="max-w-4xl mx-auto">
                        <h2 class="text-3xl font-bold text-slate-900 mb-2">Proof & Submission</h2>
                        <p class="text-slate-500 mb-8">Document your work and prepare for deployment</p>
                        
                        <!-- Step Completion Overview -->
                        <div class="bg-white rounded-xl border border-slate-200 shadow-sm p-6 mb-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-bold text-slate-900">Step Completion Overview</h3>
                                <span class="text-sm font-medium ${completed === total ? 'text-green-600' : 'text-slate-600'}">
                                    ${completed} / ${total} Completed
                                </span>
                            </div>
                            <div class="space-y-3">
                                ${projectSteps.map((step, index) => `
                                    <div class="flex items-start gap-3 p-3 rounded-lg hover:bg-slate-50 transition-colors">
                                        <input 
                                            type="checkbox" 
                                            id="${step.id}" 
                                            ${stepCompletion[step.id] ? 'checked' : ''}
                                            onchange="toggleStep('${step.id}')"
                                            class="mt-1 w-5 h-5 text-primary border-slate-300 rounded focus:ring-2 focus:ring-primary cursor-pointer"
                                        >
                                        <div class="flex-1">
                                            <label for="${step.id}" class="font-medium text-slate-900 cursor-pointer block">
                                                ${index + 1}. ${step.label}
                                            </label>
                                        </div>
                                        <span class="text-xs px-2 py-1 rounded ${stepCompletion[step.id] ? 'bg-green-100 text-green-700' : 'bg-slate-100 text-slate-500'}">
                                            ${stepCompletion[step.id] ? 'Done' : 'Pending'}
                                        </span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- Artifact Inputs -->
                        <div class="bg-white rounded-xl border border-slate-200 shadow-sm p-6 mb-6">
                            <h3 class="text-lg font-bold text-slate-900 mb-4">Artifact Links (Required for Ship Status)</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-2">
                                        Lovable Project Link *
                                    </label>
                                    <input 
                                        type="url" 
                                        id="lovable-link"
                                        value="${submission.lovableLink}"
                                        oninput="updateSubmissionField('lovableLink', this.value)"
                                        placeholder="https://lovable.dev/projects/..."
                                        class="w-full px-4 py-2 border ${isValidURL(submission.lovableLink) ? 'border-green-300 bg-green-50' : 'border-slate-300'} rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
                                    >
                                    ${isValidURL(submission.lovableLink) ?
                        '<p class="text-xs text-green-600 mt-1">✓ Valid URL</p>' :
                        '<p class="text-xs text-slate-500 mt-1">Enter a valid URL</p>'
                    }
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-2">
                                        GitHub Repository Link *
                                    </label>
                                    <input 
                                        type="url" 
                                        id="github-link"
                                        value="${submission.githubLink}"
                                        oninput="updateSubmissionField('githubLink', this.value)"
                                        placeholder="https://github.com/username/repo"
                                        class="w-full px-4 py-2 border ${isValidURL(submission.githubLink) ? 'border-green-300 bg-green-50' : 'border-slate-300'} rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
                                    >
                                    ${isValidURL(submission.githubLink) ?
                        '<p class="text-xs text-green-600 mt-1">✓ Valid URL</p>' :
                        '<p class="text-xs text-slate-500 mt-1">Enter a valid URL</p>'
                    }
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-2">
                                        Deployed URL *
                                    </label>
                                    <input 
                                        type="url" 
                                        id="deployed-link"
                                        value="${submission.deployedLink}"
                                        oninput="updateSubmissionField('deployedLink', this.value)"
                                        placeholder="https://your-app.vercel.app"
                                        class="w-full px-4 py-2 border ${isValidURL(submission.deployedLink) ? 'border-green-300 bg-green-50' : 'border-slate-300'} rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
                                    >
                                    ${isValidURL(submission.deployedLink) ?
                        '<p class="text-xs text-green-600 mt-1">✓ Valid URL</p>' :
                        '<p class="text-xs text-slate-500 mt-1">Enter a valid URL</p>'
                    }
                                </div>
                            </div>
                            
                            <button 
                                onclick="copyFinalSubmission()"
                                ${!allLinksValid ? 'disabled' : ''}
                                class="mt-6 w-full px-6 py-3 ${allLinksValid ? 'bg-primary hover:bg-primary-dark' : 'bg-slate-300 cursor-not-allowed'} text-white rounded-lg font-medium transition-colors"
                            >
                                ${allLinksValid ? 'Copy Final Submission' : 'Complete all links to copy'}
                            </button>
                        </div>
                        
                        <!-- Shipped Status -->
                        ${shipped ? `
                            <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border border-green-200 shadow-sm p-8 text-center">
                                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                    ${Icon('check-circle', 32)}
                                </div>
                                <div class="inline-block px-4 py-2 bg-green-600 text-white rounded-full text-sm font-bold mb-4">
                                    SHIPPED ✓
                                </div>
                                <div class="max-w-md mx-auto">
                                    <p class="text-slate-700 leading-relaxed mb-2">
                                        You built a real product.
                                    </p>
                                    <p class="text-slate-700 leading-relaxed mb-2">
                                        Not a tutorial. Not a clone.
                                    </p>
                                    <p class="text-slate-700 leading-relaxed mb-4">
                                        A structured tool that solves a real problem.
                                    </p>
                                    <p class="text-lg font-bold text-slate-900">
                                        This is your proof of work.
                                    </p>
                                </div>
                            </div>
                        ` : `
                            <div class="bg-slate-50 rounded-xl border border-slate-200 p-6 text-center">
                                <p class="text-sm text-slate-600 mb-2">Status: <span class="font-bold text-orange-600">In Progress</span></p>
                                <p class="text-xs text-slate-500">
                                    Complete all ${total} steps, pass all 10 tests, and provide all 3 artifact links to ship.
                                </p>
                            </div>
                        `}
                    </div>
                `;
            } else if (currentRoute === '/dashboard/ship') {
                const unlocked = isShipUnlocked();
                const { passed, total } = getTestsPassed();

                return `
                    <div class="max-w-4xl mx-auto">
                        <h2 class="text-3xl font-bold text-slate-900 mb-2">Ship Platform</h2>
                        <p class="text-slate-500 mb-8">Deploy your Placement Readiness Platform</p>
                        
                        ${!unlocked ? `
                            <!-- Locked State -->
                            <div class="bg-white rounded-xl border border-orange-200 shadow-sm p-12 text-center">
                                <div class="w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                    ${Icon('lock', 32)}
                                </div>
                                <h3 class="text-xl font-bold text-slate-900 mb-2">Shipping Locked</h3>
                                <p class="text-slate-600 mb-4">Complete all ${total} test checklist items to unlock shipping.</p>
                                <div class="bg-orange-50 border border-orange-200 rounded-lg p-4 mb-6">
                                    <p class="text-sm font-medium text-orange-800">Tests Passed: ${passed} / ${total}</p>
                                    <div class="w-full bg-orange-200 rounded-full h-2 mt-2">
                                        <div class="bg-orange-500 h-2 rounded-full transition-all" style="width: ${(passed / total) * 100}%"></div>
                                    </div>
                                </div>
                                <button onclick="navigate('/dashboard/test')" class="bg-primary text-white px-6 py-3 rounded-lg font-medium hover:bg-primary-dark transition-colors">
                                    Go to Test Checklist
                                </button>
                            </div>
                        ` : `
                            <!-- Unlocked State -->
                            <div class="bg-white rounded-xl border border-green-200 shadow-sm p-12 text-center">
                                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                    ${Icon('check-circle', 32)}
                                </div>
                                <h3 class="text-xl font-bold text-slate-900 mb-2">Ready to Ship! 🎉</h3>
                                <p class="text-slate-600 mb-6">All tests passed. Your platform is ready for deployment.</p>
                                
                                <div class="bg-green-50 border border-green-200 rounded-lg p-6 mb-6 text-left">
                                    <h4 class="font-bold text-slate-900 mb-3">Deployment Checklist:</h4>
                                    <ul class="space-y-2 text-sm text-slate-700">
                                        <li class="flex items-start gap-2">
                                            <span class="text-green-600 mt-0.5">✓</span>
                                            <span>All ${total} tests verified and passing</span>
                                        </li>
                                        <li class="flex items-start gap-2">
                                            <span class="text-green-600 mt-0.5">✓</span>
                                            <span>Code pushed to GitHub repository</span>
                                        </li>
                                        <li class="flex items-start gap-2">
                                            <span class="text-green-600 mt-0.5">✓</span>
                                            <span>Premium design maintained throughout</span>
                                        </li>
                                        <li class="flex items-start gap-2">
                                            <span class="text-green-600 mt-0.5">✓</span>
                                            <span>All features working offline</span>
                                        </li>
                                    </ul>
                                </div>
                                
                                <div class="flex gap-4 justify-center">
                                    <button onclick="navigate('/dashboard/test')" class="px-6 py-3 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors font-medium">
                                        Review Tests
                                    </button>
                                    <button class="bg-green-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-green-700 transition-colors">
                                        Deploy Now
                                    </button>
                                </div>
                            </div>
                        `}
                    </div>
                `;
            } else if (currentRoute.startsWith('/dashboard/results')) {
                const analysis = currentAnalysis;
                if (!analysis) {
                    return `
                        <div class="max-w-4xl mx-auto text-center">
                            <div class="bg-white rounded-xl border border-slate-200 shadow-sm p-12">
                                ${Icon('search', 48)}
                                <p class="mt-4 text-slate-500">No analysis found. Please analyze a job description first.</p>
                                <button onclick="navigate('/dashboard/analyze')" class="mt-6 bg-primary text-white px-6 py-2 rounded-lg font-medium hover:bg-primary-dark transition-colors">
                                    Analyze JD
                                </button>
                            </div>
                        </div>
                    `;
                }

                return `
                    <div class="max-w-6xl mx-auto">
                        <div class="flex items-center justify-between mb-8">
                            <div>
                                <h2 class="text-3xl font-bold text-slate-900">${analysis.company}</h2>
                                <p class="text-slate-500">${analysis.role}</p>
                            </div>
                            <div class="text-center">
                                <p class="text-5xl font-bold text-primary">${analysis.finalScore || analysis.readinessScore || 0}</p>
                                <p class="text-sm text-slate-500">Readiness Score</p>
                            </div>
                        </div>
                        
                        <div class="grid gap-6">
                            <!-- Export Buttons -->
                            <div class="flex flex-wrap gap-3">
                                <button onclick="export7DayPlan()" class="px-4 py-2 bg-white border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors text-sm font-medium">
                                    Copy 7-Day Plan
                                </button>
                                <button onclick="exportChecklist()" class="px-4 py-2 bg-white border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors text-sm font-medium">
                                    Copy Round Checklist
                                </button>
                                <button onclick="exportQuestions()" class="px-4 py-2 bg-white border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors text-sm font-medium">
                                    Copy 10 Questions
                                </button>
                                <button onclick="downloadTXT()" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors text-sm font-medium">
                                    Download as TXT
                                </button>
                            </div>
                            
                            <!-- Extracted Skills with Toggles -->
                            <div class="bg-white rounded-xl border border-slate-200 shadow-sm p-6">
                                <h3 class="text-lg font-bold text-slate-900 mb-2">Extracted Skills</h3>
                                <p class="text-sm text-slate-500 mb-4">Toggle your confidence level to update your readiness score</p>
                                <div class="space-y-3">
                                    ${Object.entries(analysis.extractedSkills).map(([category, skills]) => `
                                        <div>
                                            <p class="text-sm font-medium text-slate-700 mb-2">${category}</p>
                                            <div class="flex flex-wrap gap-2">
                                                ${skills.map(skill => {
                    const confidence = analysis.skillConfidenceMap[skill] || 'practice';
                    const isKnow = confidence === 'know';
                    return `
                                                        <button onclick="toggleSkillConfidence('${skill}')" class="group relative px-3 py-1 rounded-full text-sm font-medium transition-all ${isKnow
                            ? 'bg-green-100 text-green-700 border-2 border-green-400'
                            : 'bg-orange-100 text-orange-700 border-2 border-orange-400'
                        }">
                                                            ${skill}
                                                            <span class="ml-1 text-xs">${isKnow ? '✓' : '⚠'}</span>
                                                            <span class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-slate-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap">
                                                                ${isKnow ? 'I know this' : 'Need practice'}
                                                            </span>
                                                        </button>
                                                    `;
                }).join('')}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <!-- Company Intel -->
                            ${analysis.companyIntel ? `
                                <div class="bg-white rounded-xl border border-slate-200 shadow-sm p-6">
                                    <div class="flex items-center justify-between mb-4">
                                        <h3 class="text-lg font-bold text-slate-900">Company Intel</h3>
                                        <span class="text-xs text-slate-400 italic">Demo Mode: Heuristically generated</span>
                                    </div>
                                    <div class="grid md:grid-cols-3 gap-4 mb-4">
                                        <div>
                                            <p class="text-xs text-slate-500 mb-1">Company Size</p>
                                            <p class="font-bold text-slate-900">${analysis.companyIntel.size}</p>
                                            <p class="text-xs text-slate-500 mt-1">
                                                ${analysis.companyIntel.size === 'Enterprise' ? '2000+ employees' :
                            analysis.companyIntel.size === 'Mid-size' ? '200-2000 employees' :
                                '<200 employees'}
                                            </p>
                                        </div>
                                        <div>
                                            <p class="text-xs text-slate-500 mb-1">Industry</p>
                                            <p class="font-bold text-slate-900">${analysis.companyIntel.industry}</p>
                                        </div>
                                        <div>
                                            <p class="text-xs text-slate-500 mb-1">Hiring Type</p>
                                            <p class="font-bold text-slate-900">
                                                ${analysis.companyIntel.size === 'Enterprise' ? 'Structured Process' :
                            analysis.companyIntel.size === 'Mid-size' ? 'Balanced Approach' :
                                'Fast-paced'}
                                            </p>
                                        </div>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-slate-700 mb-2">Typical Hiring Focus</p>
                                        <ul class="space-y-1">
                                            ${analysis.companyIntel.hiringFocus.map(focus => `
                                                <li class="text-sm text-slate-600 flex items-start gap-2">
                                                    <span class="text-primary mt-1">•</span>
                                                    <span>${focus}</span>
                                                </li>
                                            `).join('')}
                                        </ul>
                                    </div>
                                </div>
                            ` : ''}
                            
                            <!-- Round Mapping -->
                            ${analysis.roundMapping ? `
                                <div class="bg-white rounded-xl border border-slate-200 shadow-sm p-6">
                                    <h3 class="text-lg font-bold text-slate-900 mb-4">Expected Interview Rounds</h3>
                                    <div class="relative">
                                        <!-- Vertical timeline line -->
                                        <div class="absolute left-4 top-0 bottom-0 w-0.5 bg-slate-200"></div>
                                        
                                        <div class="space-y-6">
                                            ${analysis.roundMapping.map((round, index) => `
                                                <div class="relative pl-12">
                                                    <!-- Timeline dot -->
                                                    <div class="absolute left-0 w-8 h-8 bg-primary text-white rounded-full flex items-center justify-center text-sm font-bold">
                                                        ${index + 1}
                                                    </div>
                                                    <div>
                                                        <h4 class="font-bold text-slate-900 mb-1">${round.name}</h4>
                                                        <p class="text-sm text-slate-600 mb-2">${round.description}</p>
                                                        <div class="bg-indigo-50 border-l-4 border-primary pl-3 py-2">
                                                            <p class="text-xs text-slate-600"><span class="font-medium">Why this matters:</span> ${round.why}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                </div>
                            ` : ''}
                            
                            <!-- Round-wise Checklist -->
                            <div class="bg-white rounded-xl border border-slate-200 shadow-sm p-6">
                                <h3 class="text-lg font-bold text-slate-900 mb-4">Round-wise Preparation Checklist</h3>
                                <div class="space-y-6">
                                    ${Object.entries(analysis.checklist).map(([round, items]) => `
                                        <div>
                                            <h4 class="font-bold text-slate-900 mb-3">${round}</h4>
                                            <ul class="space-y-2">
                                                ${items.map(item => `
                                                    <li class="flex items-start gap-2 text-sm text-slate-600">
                                                        <span class="text-primary mt-1">•</span>
                                                        <span>${item}</span>
                                                    </li>
                                                `).join('')}
                                            </ul>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <!-- 7-Day Plan -->
                            <div class="bg-white rounded-xl border border-slate-200 shadow-sm p-6">
                                <h3 class="text-lg font-bold text-slate-900 mb-4">7-Day Preparation Plan</h3>
                                <div class="space-y-4">
                                    ${Object.entries(analysis.plan).map(([day, tasks]) => `
                                        <div class="border-l-4 border-primary pl-4">
                                            <h4 class="font-bold text-slate-900 mb-2">${day}</h4>
                                            <ul class="space-y-1">
                                                ${tasks.map(task => `
                                                    <li class="text-sm text-slate-600">• ${task}</li>
                                                `).join('')}
                                            </ul>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <!-- Interview Questions -->
                            <div class="bg-white rounded-xl border border-slate-200 shadow-sm p-6">
                                <h3 class="text-lg font-bold text-slate-900 mb-4">10 Likely Interview Questions</h3>
                                <ol class="space-y-3">
                                    ${analysis.questions.map((q, i) => `
                                        <li class="flex gap-3">
                                            <span class="flex-shrink-0 w-6 h-6 bg-primary text-white rounded-full flex items-center justify-center text-xs font-bold">${i + 1}</span>
                                            <span class="text-slate-700">${q}</span>
                                        </li>
                                    `).join('')}
                                </ol>
                            </div>
                            
                            <!-- Action Next Box -->
                            <div class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl border border-indigo-200 shadow-sm p-6">
                                <h3 class="text-lg font-bold text-slate-900 mb-4">🎯 Action Next</h3>
                                ${(() => {
                        const weakSkills = Object.entries(analysis.skillConfidenceMap)
                            .filter(([_, conf]) => conf === 'practice')
                            .map(([skill]) => skill)
                            .slice(0, 3);

                        return `
                                        ${weakSkills.length > 0 ? `
                                            <div class="mb-4">
                                                <p class="text-sm font-medium text-slate-700 mb-2">Focus on these skills:</p>
                                                <div class="flex flex-wrap gap-2">
                                                    ${weakSkills.map(skill => `
                                                        <span class="px-3 py-1 bg-white border border-orange-300 text-orange-700 rounded-full text-sm font-medium">${skill}</span>
                                                    `).join('')}
                                                </div>
                                            </div>
                                        ` : ''}
                                        <div class="bg-white rounded-lg p-4 border border-indigo-200">
                                            <p class="text-slate-700 font-medium mb-2">💡 Suggested Next Step:</p>
                                            <p class="text-slate-600 text-sm mb-3">Start Day 1 of your preparation plan now. Focus on fundamentals and review your projects.</p>
                                            <button onclick="navigate('/dashboard/practice')" class="bg-primary text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-primary-dark transition-colors">
                                                Start Day 1 Plan
                                            </button>
                                        </div>
                                    `;
                    })()}
                            </div>
                        </div>
                    </div>
                `;
            } else {
                const routes = {
                    '/dashboard/practice': { title: 'Practice', desc: 'Solve coding problems and improve your skills.' },
                    '/dashboard/assessments': { title: 'Assessments', desc: 'Take mock tests and evaluate your readiness.' },
                    '/dashboard/profile': { title: 'Profile', desc: 'Manage your account and track your progress.' }
                };
                const current = routes[currentRoute] || { title: 'Page', desc: 'Content coming soon.' };
                return `
                    <div class="max-w-4xl">
                        <h2 class="text-2xl font-bold text-slate-900 mb-2">${current.title}</h2>
                        <p class="text-slate-500 mb-8 font-medium">${current.desc}</p>
                        <div class="bg-white rounded-xl border border-slate-200 shadow-sm h-64 flex flex-col items-center justify-center text-slate-300 gap-4">
                            ${Icon('construction', 48)}
                            <span class="italic font-medium">This module is currently under development.</span>
                        </div>
                    </div>
                `;
            }
        }

        function navLink(path, icon, label) {
            const isActive = currentRoute === path;
            return `
                <a href="#${path}" class="flex items-center gap-3 px-3 py-2 rounded-lg transition-colors ${isActive ? 'bg-primary text-white shadow-md' : 'text-slate-600 hover:bg-slate-100 hover:text-primary'
                }">
                    ${Icon(icon)}
                    <span class="font-medium">${label}</span>
                </a>
            `;
        }

        function handleAnalyze(event) {
            event.preventDefault();
            const company = document.getElementById('company-input').value;
            const role = document.getElementById('role-input').value;
            const jdText = document.getElementById('jd-input').value;

            analyzeJD(company, role, jdText);
            navigate('/dashboard/results');
        }

        function viewAnalysis(id) {
            const history = getHistory();
            const analysis = history.find(item => item.id === id);
            if (analysis) {
                currentAnalysis = analysis;
                navigate('/dashboard/results');
            }
        }

        function navigate(path) {
            window.location.hash = path;
        }

        function render() {
            currentRoute = window.location.hash.slice(1) || '/';
            const app = document.getElementById('app');

            if (currentRoute === '/' || currentRoute === '') {
                app.innerHTML = renderLanding();
            } else {
                app.innerHTML = renderDashboard();

                // Initialize radar chart if on dashboard
                if (currentRoute === '/dashboard') {
                    setTimeout(() => initRadarChart(), 100);
                }
            }
        }

        function initRadarChart() {
            const container = document.getElementById('radar-chart');
            if (!container || !window.Recharts) return;

            const data = [
                { subject: 'DSA', score: 75, fullMark: 100 },
                { subject: 'System Design', score: 60, fullMark: 100 },
                { subject: 'Communication', score: 80, fullMark: 100 },
                { subject: 'Resume', score: 85, fullMark: 100 },
                { subject: 'Aptitude', score: 70, fullMark: 100 }
            ];

            const { RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis, Radar, ResponsiveContainer } = window.Recharts;

            const chart = React.createElement(ResponsiveContainer, { width: '100%', height: 250 },
                React.createElement(RadarChart, { data: data },
                    React.createElement(PolarGrid, { stroke: '#e2e8f0' }),
                    React.createElement(PolarAngleAxis, { dataKey: 'subject', tick: { fill: '#64748b', fontSize: 12 } }),
                    React.createElement(PolarRadiusAxis, { angle: 90, domain: [0, 100], tick: { fill: '#94a3b8', fontSize: 10 } }),
                    React.createElement(Radar, {
                        name: 'Skills',
                        dataKey: 'score',
                        stroke: 'hsl(245, 58%, 51%)',
                        fill: 'hsl(245, 58%, 51%)',
                        fillOpacity: 0.3
                    })
                )
            );

            ReactDOM.render(chart, container);
        }

        // --- PROJECT 3: AI RESUME BUILDER LOGIC ---

        const rbSteps = [
            { id: 1, route: '/rb/01-problem', title: 'Problem Definition', prompt: 'Define the core problem the AI Resume Builder solves. Focus on ATS rejection rates and generic formatting. Specifically, address how automated tracking systems discard up to 75% of resumes before human review, and how generic templates fail to highlight key skills relevant to specific job descriptions.' },
            { id: 2, route: '/rb/02-market', title: 'Market Research', prompt: 'Analyze the current market for resume builders. Identify key competitors like Resume.io, Teal, and NovoResume. Highlight their strengths (UI/UX, templates) and weaknesses (generic AI content, lack of specific ATS optimization). Identify the gap for a "Precision-Matched" AI Resume Builder.' },
            { id: 3, route: '/rb/03-architecture', title: 'Architecture', prompt: 'Outline the technical architecture for the MVP. Frontend: React + Tailwind CSS. Backend: Node.js + Express. AI Integration: OpenAI API (GPT-4 for generation). Database: MongoDB for user profiles and resume data. file storage: AWS S3 or similar for PDF storage. Authentication: Firebase or JWT.' },
            { id: 4, route: '/rb/04-hld', title: 'High-Level Design', prompt: 'Create the High-Level Design (HLD) diagram. Include: 1. User Interface (Input Form, Preview). 2. API Gateway. 3. Resume Parser Service (extracts text from existing PDFs). 4. AI Enhancement Engine (optimizes text based on job description). 5. PDF Generation Service (renders final document).' },
            { id: 5, route: '/rb/05-lld', title: 'Low-Level Design', prompt: 'Detail the Low-Level Design (LLD). Database Schemas: User { id, email, subscription }, Resume { id, userId, data: { personalInfo, experience[], education[], skills[] } }, JobDescription { id, text, keywords[] }. API Endpoints: POST /api/resumes/generate, POST /api/resumes/parse, GET /api/resumes/:id.' },
            { id: 6, route: '/rb/06-build', title: 'Build Phase', prompt: 'Initialize the project repository. Set up standard folder structure:\\n/client (React app)\\n  /src/components (ResumeForm, Preview, Dashboard)\\n  /src/services (api.js)\\n/server (Node app)\\n  /routes (resumeRoutes.js)\\n  /controllers (resumeController.js)\\n  /models (Resume.js)\\n\\nInstall dependencies: react, axios, express, mongoose, openai.' },
            { id: 7, route: '/rb/07-test', title: 'Test Plan', prompt: 'Design a test plan. Unit Tests: Test ResumeParser with various PDF formats. Integration Tests: Verify AI generation produces valid JSON structure. End-to-End Tests: User flow from signup -> input resume -> input JD -> generate optimized resume -> download PDF.' },
            { id: 8, route: '/rb/08-ship', title: 'Ship Strategy', prompt: 'Define the deployment strategy. Frontend: Deploy to Vercel. Backend: Deploy to Railway or Render. Database: MongoDB Atlas. secure environment variables. Set up a CI/CD pipeline using GitHub Actions to run tests on push and deploy on merge to main.' }
        ];

        function getRbArtifact(stepId) {
            return localStorage.getItem(`rb_step_${stepId}_artifact`) || '';
        }

        function saveRbArtifact(stepId, content) {
            localStorage.setItem(`rb_step_${stepId}_artifact`, content);
            render();
        }

        function getRbStepStatus(stepId) {
            return JSON.parse(localStorage.getItem(`rb_step_${stepId}_status`)) || { worked: null, error: false };
        }

        function saveRbStepStatus(stepId, status) {
            localStorage.setItem(`rb_step_${stepId}_status`, JSON.stringify(status));
            render();
        }

        function getRbProofSubmission() {
            return JSON.parse(localStorage.getItem('rb_proof_submission')) || { lovable: '', github: '', deploy: '' };
        }

        function saveRbProofSubmission(data) {
            localStorage.setItem('rb_proof_submission', JSON.stringify(data));
        }

        function isRbStepComplete(stepId) {
            return !!getRbArtifact(stepId);
        }

        function canAccessRbStep(stepId) {
            if (stepId === 1) return true;
            return isRbStepComplete(stepId - 1);
        }

        function getRbProjectStatus() {
            const completedCount = rbSteps.filter(s => isRbStepComplete(s.id)).length;
            if (completedCount === 8) return 'Completed';
            if (completedCount > 0) return 'In Progress';
            return 'Not Started';
        }

        // --- UNIFIED ROUTER & RENDER ---

        function navigate(route) {
            window.location.hash = route;
        }

        window.addEventListener('hashchange', () => {
            const hash = window.location.hash.slice(1) || '/';
            currentRoute = hash;
            render();
        });

        // Helper to check if we are in Project 3 mode
        function isRbRoute(route) {
            return route.startsWith('/rb/');
        }

        function render() {
            const app = document.getElementById('app');

            if (isRbRoute(currentRoute)) {
                renderRbProject(app);
            } else {
                renderPlacementProject(app);
            }
        }

        // --- RENDER PROJECT 2 (Placement Readiness) ---
        function renderPlacementProject(container) {
            let content = '';

            if (currentRoute === '/') {
                content = renderLanding();
            } else if (currentRoute === '/dashboard') {
                content = renderDashboard();
            } else if (currentRoute === '/analyze') {
                content = renderAnalyze();
            } else if (currentRoute === '/history') {
                content = renderHistory();
            } else if (currentRoute.startsWith('/history/')) {
                const id = currentRoute.split('/')[2];
                const entry = getHistory().find(h => h.id === id);
                if (entry) {
                    currentAnalysis = entry;
                    content = renderResults();
                } else {
                    content = `<div class="p-8 text-center">History entry not found. <button class="text-primary underline" onclick="navigate('/history')">Go back</button></div>`;
                }
            } else if (currentRoute === '/results') {
                if (!currentAnalysis) {
                    navigate('/analyze');
                    return;
                }
                content = renderResults();
            } else if (currentRoute === '/test') {
                content = renderTestChecklist();
            } else if (currentRoute === '/proof') {
                content = renderProof();
            } else if (currentRoute === '/resume') {
                content = renderResumeHome();
            } else if (currentRoute === '/resume/builder') {
                content = renderResumeBuilder();
            } else if (currentRoute === '/resume/preview') {
                content = renderResumePreview();
            } else if (currentRoute === '/resume/proof') {
                content = renderResumeProof();
            } else {
                content = renderLanding();
            }

            container.innerHTML = content;
        }

        // --- RENDER PROJECT 3 (AI Resume Builder) ---
        function renderRbProject(container) {
            const step = rbSteps.find(s => s.route === currentRoute) || rbSteps[0];
            const isProof = currentRoute === '/rb/proof';

            const statusBadgeColor = getRbProjectStatus() === 'Completed' ? 'bg-green-100 text-green-800' : 'bg-orange-100 text-orange-800';

            const topBar = `
                <header class="h-16 bg-white border-b border-slate-200 flex items-center justify-between px-8 sticky top-0 z-50">
                    <div class="flex items-center gap-4">
                        <span class="text-lg font-serif font-bold text-slate-900">AI Resume Builder</span>
                        <div class="h-6 w-px bg-slate-200"></div>
                        <nav class="flex gap-4 text-sm font-medium text-slate-600">
                             <button onclick="navigate('/')" class="hover:text-primary transition-colors">Platform Home</button>
                        </nav>
                    </div>
                    <div class="text-center">
                        <p class="text-sm font-medium text-slate-900">${isProof ? 'Final Verification' : `Project 3 — Step ${step.id} of 8`}</p>
                        <p class="text-xs text-slate-500">${isProof ? 'Ready to Ship' : step.title}</p>
                    </div>
                    <div>
                        <span class="px-3 py-1 rounded-full text-xs font-bold ${statusBadgeColor}">${getRbProjectStatus()}</span>
                    </div>
                </header>
            `;

            const contextHeader = `
                <section class="max-w-7xl mx-auto px-8 py-8">
                    <h1 class="text-3xl font-serif font-bold text-slate-900 mb-2">${isProof ? 'Proof of Build' : step.title}</h1>
                    <p class="text-slate-600 max-w-2xl">${isProof ? 'Verify milestones and submit artifacts.' : step.prompt}</p>
                </section>
            `;

            let mainContent = '';
            let buildPanel = '';
            let footer = '';

            if (isProof) {
                const submission = getRbProofSubmission();
                const linksValid = submission.lovable && submission.github && submission.deploy;

                mainContent = `
                    <div class="bg-white rounded-xl border border-slate-200 p-8 shadow-sm">
                        <h2 class="text-xl font-bold mb-6">Build Track Progress</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                            ${rbSteps.map(s => {
                    const done = isRbStepComplete(s.id);
                    return `
                                    <div class="flex items-center justify-between p-4 rounded-lg border ${done ? 'bg-green-50 border-green-200' : 'bg-slate-50 border-slate-200'}">
                                        <div class="flex items-center gap-3">
                                            <div class="${done ? 'text-green-600' : 'text-slate-400'}">${done ? Icon('check-circle') : Icon('circle')}</div>
                                            <span class="text-sm font-medium ${done ? 'text-green-900' : 'text-slate-700'}">Step ${s.id}: ${s.title}</span>
                                        </div>
                                    </div>
                                `;
                }).join('')}
                        </div>

                        <h2 class="text-xl font-bold mb-6">Artifact Submission</h2>
                        <div class="space-y-4 max-w-xl">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">Lovable Project Link</label>
                                <input type="text" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:outline-none" 
                                    value="${submission.lovable}" 
                                    oninput="saveRbProofSubmission({...getRbProofSubmission(), lovable: this.value}); render();" 
                                    placeholder="https://lovable.dev/...">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">GitHub Repository Link</label>
                                <input type="text" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:outline-none" 
                                    value="${submission.github}" 
                                    oninput="saveRbProofSubmission({...getRbProofSubmission(), github: this.value}); render();"
                                    placeholder="https://github.com/...">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">Deployed URL</label>
                                <input type="text" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:outline-none" 
                                    value="${submission.deploy}" 
                                    oninput="saveRbProofSubmission({...getRbProofSubmission(), deploy: this.value}); render();"
                                    placeholder="https://....vercel.app">
                            </div>
                        </div>
                    </div>
                `;

                footer = `
                    <footer class="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 h-20 flex items-center justify-between px-8 z-50">
                        <div class="text-sm text-slate-600">
                            Status: <span class="font-bold text-slate-900">${getRbProjectStatus()}</span>
                        </div>
                        <button onclick="const s = getRbProofSubmission(); navigator.clipboard.writeText(\`Final Submission:\\nLovable: \${s.lovable}\\nGithub: \${s.github}\\nDeploy: \${s.deploy}\`); alert('Copied!');" 
                            class="px-6 py-3 bg-primary text-white rounded-lg font-bold hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed"
                            ${!linksValid ? 'disabled' : ''}>
                            Copy Final Submission
                        </button>
                    </footer>
                `;

            } else {
                const artifact = getRbArtifact(step.id);
                const status = getRbStepStatus(step.id);
                const locked = !canAccessRbStep(step.id);

                if (locked) {
                    mainContent = `
                        <div class="flex flex-col items-center justify-center p-12 bg-slate-50 border border-slate-200 border-dashed rounded-xl h-96">
                            <div class="text-slate-400 mb-4">${Icon('lock', 48)}</div>
                            <h3 class="text-xl font-bold text-slate-900">Step Locked</h3>
                            <p class="text-slate-500 mb-6">Complete Step ${step.id - 1} to unlock this phase.</p>
                            <button onclick="navigate('${rbSteps[step.id - 2].route}')" class="text-primary font-medium hover:underline">Go to Previous Step</button>
                        </div>
                    `;
                } else {
                    mainContent = `
                        <div class="bg-white rounded-xl border border-slate-200 p-8 shadow-sm">
                            <label class="block text-sm font-bold text-slate-900 mb-4">Your Artifact</label>
                            <textarea class="w-full h-64 p-4 border border-slate-200 rounded-lg font-mono text-sm bg-slate-50 focus:ring-2 focus:ring-primary focus:outline-none resize-none"
                                placeholder="Paste your code, terminal output, or implementation notes here..."
                                oninput="saveRbArtifact(${step.id}, this.value)"
                                onblur="render()">${artifact}</textarea>
                            <p class="text-xs text-slate-500 mt-2">Content auto-saves on blur. Required to unlock next step.</p>
                            
                            <div class="flex justify-between mt-8">
                                <button onclick="navigate('${step.id > 1 ? rbSteps[step.id - 2].route : '#'}')" 
                                    class="px-6 py-2 border border-slate-300 rounded-lg text-slate-700 hover:bg-slate-50 ${step.id === 1 ? 'opacity-50 cursor-not-allowed' : ''}"
                                    ${step.id === 1 ? 'disabled' : ''}>
                                    Previous
                                </button>
                                
                                <button onclick="navigate('${step.id < 8 ? rbSteps[step.id].route : '/rb/proof'}')" 
                                    class="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark ${!artifact ? 'opacity-50 cursor-not-allowed' : ''}"
                                    ${!artifact ? 'disabled' : ''}>
                                    ${step.id < 8 ? 'Next Step' : 'Finish & Proof'}
                                </button>
                            </div>
                        </div>
                    `;

                    buildPanel = `
                        <div class="bg-white border-l border-slate-200 h-[calc(100vh-4rem)] sticky top-16 p-6 overflow-y-auto">
                            <h3 class="text-sm font-bold text-slate-900 uppercase tracking-wide mb-6">Build Actions</h3>
                            
                            <div class="mb-8">
                                <label class="block text-xs font-bold text-slate-500 mb-2">COPY THIS INTO LOVABLE</label>
                                <div class="bg-slate-50 border border-slate-200 rounded p-3 text-xs text-slate-600 font-mono mb-3 max-h-40 overflow-y-auto">
                                    ${step.prompt}
                                </div>
                                <button onclick="navigator.clipboard.writeText(\`${step.prompt.replace(/`/g, '\\`')}\`); alert('Prompt copied!');" 
                                    class="w-full py-2 border border-slate-300 rounded text-sm font-medium hover:bg-slate-50 text-slate-700 flex items-center justify-center gap-2">
                                    ${Icon('copy', 16)} Copy Prompt
                                </button>
                            </div>

                            <div>
                                <label class="block text-xs font-bold text-slate-500 mb-2">BUILD STATUS</label>
                                <div class="flex gap-2 mb-3">
                                    <button onclick="saveRbStepStatus(${step.id}, {worked: true, error: false})" class="flex-1 py-2 bg-green-600 text-white rounded text-xs font-bold hover:bg-green-700">✓ It Worked</button>
                                    <button onclick="saveRbStepStatus(${step.id}, {worked: false, error: true})" class="flex-1 py-2 bg-red-600 text-white rounded text-xs font-bold hover:bg-red-700">✗ Error</button>
                                </div>
                                <button onclick="alert('Screenshot upload placeholder')" class="w-full py-2 border border-slate-300 rounded text-xs font-medium text-slate-600 hover:bg-slate-50">
                                    Add Screenshot
                                </button>
                                
                                ${status.worked !== null ? `
                                    <div class="mt-4 p-2 rounded text-xs font-bold text-center ${status.worked ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}">
                                        ${status.worked ? 'Marked as Success' : 'Marked as Error'}
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }
            }

            container.innerHTML = `
                ${topBar}
                ${contextHeader}
                <div class="flex max-w-7xl mx-auto px-8 pb-24 gap-8">
                    <main class="flex-1 min-w-0">
                        ${mainContent}
                    </main>
                    <aside class="w-80 flex-shrink-0 hidden lg:block">
                        ${!isProof ? buildPanel : ''}
                    </aside>
                </div>
                ${footer}
            `;
        }

        // --- DASHBOARD UPDATE ---
        function renderDashboard() {
            return `
                <div class="min-h-screen flex bg-slate-50">
                    <nav class="w-64 bg-white border-r border-slate-200 p-6 flex flex-col h-screen sticky top-0">
                       <div class="flex items-center gap-2 mb-8 text-primary">
                           ${Icon('layout')}
                           <span class="font-bold text-lg">Placement Prep</span>
                       </div>
                       
                       <div class="space-y-1">
                           <a href="#/dashboard" class="flex items-center gap-3 px-3 py-2 text-primary bg-indigo-50 rounded-lg font-medium">
                               ${Icon('layout-dashboard')} Dashboard
                           </a>
                           <a href="#/analyze" class="flex items-center gap-3 px-3 py-2 text-slate-600 hover:bg-slate-50 rounded-lg font-medium transition-colors">
                               ${Icon('search')} Analyze JD
                           </a>
                           <a href="#/history" class="flex items-center gap-3 px-3 py-2 text-slate-600 hover:bg-slate-50 rounded-lg font-medium transition-colors">
                               ${Icon('clock')} History
                           </a>
                           <a href="#/test" class="flex items-center gap-3 px-3 py-2 text-slate-600 hover:bg-slate-50 rounded-lg font-medium transition-colors">
                               ${Icon('clipboard-check')} Verify & Ship
                           </a>
                       </div>

                       <div class="mt-8 pt-8 border-t border-slate-100">
                           <p class="px-3 text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Projects</p>
                           <a href="#/rb/01-problem" class="flex items-center gap-3 px-3 py-2 text-slate-600 hover:bg-slate-50 rounded-lg font-medium transition-colors">
                               ${Icon('code')} AI Resume Builder
                           </a>
                       </div>
                    </nav>

                    <main class="flex-1 p-8 overflow-y-auto">
                        <header class="flex justify-between items-center mb-8">
                            <div>
                                <h1 class="text-2xl font-bold text-slate-900">Dashboard</h1>
                                <p class="text-slate-500">Welcome back to your placement journey.</p>
                            </div>
                            <div class="flex gap-4">
                                <button class="p-2 text-slate-400 hover:text-slate-600 transition-colors">${Icon('bell')}</button>
                                <div class="w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center text-primary font-bold">U</div>
                            </div>
                        </header>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div class="bg-white p-6 rounded-xl border border-slate-100 shadow-sm">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="font-medium text-slate-500">Analyses Run</h3>
                                    <div class="text-indigo-500">${Icon('search')}</div>
                                </div>
                                <p class="text-3xl font-bold text-slate-900">${getHistory().length}</p>
                            </div>
                            
                            <div class="bg-gradient-to-br from-indigo-600 to-indigo-700 p-6 rounded-xl shadow-lg run-project-3 cursor-pointer text-white" onclick="navigate('/rb/01-problem')">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="font-medium text-indigo-100">Active Build</h3>
                                    <div class="opacity-80">${Icon('code')}</div>
                                </div>
                                <p class="text-2xl font-bold mb-1">AI Resume Builder</p>
                                <p class="text-sm text-indigo-100 opacity-90">Step ${rbSteps.filter(s => isRbStepComplete(s.id)).length + 1} of 8 Pending</p>
                            </div>

                            <div class="bg-gradient-to-br from-emerald-600 to-emerald-700 p-6 rounded-xl shadow-lg cursor-pointer text-white" onclick="navigate('/resume')">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="font-medium text-emerald-100">Resume App</h3>
                                    <div class="opacity-80">${Icon('user')}</div>
                                </div>
                                <p class="text-2xl font-bold mb-1">Build Resume</p>
                                <p class="text-sm text-emerald-100 opacity-90">Create ATS-optimized resume</p>
                            </div>
                        </div>

                         <h3 class="font-bold text-slate-900 mb-4">Recent Analyses</h3>
                         <div class="bg-white rounded-xl border border-slate-100 shadow-sm overflow-hidden">
                             ${getHistory().length > 0 ? getHistory().slice(0, 3).map(h => `
                                 <div class="p-4 border-b border-slate-50 last:border-0 hover:bg-slate-50 transition-colors cursor-pointer" onclick="navigate('/history/${h.id}')">
                                     <div class="flex justify-between items-start">
                                         <div>
                                             <h4 class="font-bold text-slate-900">${h.role}</h4>
                                             <p class="text-sm text-slate-500">${h.company} • ${new Date(h.createdAt).toLocaleDateString()}</p>
                                         </div>
                                         <span class="px-2 py-1 rounded bg-indigo-50 text-indigo-700 text-xs font-bold">${h.finalScore}%</span>
                                     </div>
                                 </div>
                             `).join('') : '<div class="p-8 text-center text-slate-500">No analyses yet.</div>'}
                         </div>
                    </main>
                </div>
            `;
        }

        // --- PROJECT 4: AI RESUME BUILDER APP ---

        function getResumeData() {
            const saved = localStorage.getItem('resumeBuilderData');
            let data = saved ? JSON.parse(saved) : {
                personal: { name: '', email: '', phone: '', location: '' },
                summary: '',
                education: [],
                experience: [],
                projects: [],
                skills: { technical: [], soft: [], tools: [] },
                links: { github: '', linkedin: '' }
            };

            // Backward Compatibility: Convert string skills to object
            if (typeof data.skills === 'string') {
                const oldSkills = data.skills.split(',').map(s => s.trim()).filter(s => s);
                data.skills = {
                    technical: oldSkills,
                    soft: [],
                    tools: []
                };
            }

            // Backward Compatibility: Update generic skills structure if missing categories
            if (data.skills && !data.skills.technical) {
                data.skills = { technical: [], soft: [], tools: [] };
            }

            // Backward Compatibility: Convert projects tech string to array
            if (data.projects) {
                data.projects = data.projects.map(p => ({
                    ...p,
                    tech: Array.isArray(p.tech) ? p.tech : (p.tech ? p.tech.split(',').map(s => s.trim()).filter(s => s) : []),
                    liveUrl: p.liveUrl || '',
                    githubUrl: p.githubUrl || '',
                    isCollapsed: p.isCollapsed !== undefined ? p.isCollapsed : true
                }));
            }

            return data;
        }

        function saveResumeData(data) {
            localStorage.setItem('resumeBuilderData', JSON.stringify(data));
            render();
        }

        function calculateATSScore(data) {
            let score = 0;
            const suggestions = [];

            // +15 if summary length is 40-120 words
            const summaryWords = data.summary.trim().split(/\s+/).filter(w => w.length > 0).length;
            if (summaryWords >= 40 && summaryWords <= 120) {
                score += 15;
            } else if (summaryWords < 40) {
                suggestions.push('Write a stronger summary (40–120 words).');
            }

            // +10 if at least 2 projects
            if (data.projects.length >= 2) {
                score += 10;
            } else {
                suggestions.push('Add at least 2 projects.');
            }

            // +10 if at least 1 experience entry
            if (data.experience.length >= 1) {
                score += 10;
            } else {
                suggestions.push('Add at least 1 work experience entry.');
            }

            // +10 if skills list has ≥8 items total
            const totalSkillsCount = (data.skills.technical?.length || 0) +
                (data.skills.soft?.length || 0) +
                (data.skills.tools?.length || 0);
            if (totalSkillsCount >= 8) {
                score += 10;
            } else {
                suggestions.push('Add more skills (target 8+ total).');
            }

            // +10 if GitHub or LinkedIn link exists
            if (data.links.github || data.links.linkedin) {
                score += 10;
            } else {
                suggestions.push('Add GitHub or LinkedIn profile link.');
            }

            // +15 if any experience/project bullet contains numbers
            const hasNumbers = [...data.experience, ...data.projects].some(item => {
                const desc = item.description || '';
                return /\d+[%kKmM]?|\d+\+|[0-9]/.test(desc);
            });
            if (hasNumbers) {
                score += 15;
            } else if (data.experience.length > 0 || data.projects.length > 0) {
                suggestions.push('Add measurable impact (numbers, %, metrics) in bullets.');
            }

            // +10 if education has complete fields
            const hasCompleteEducation = data.education.some(edu =>
                edu.degree && edu.school && edu.year
            );
            if (hasCompleteEducation) {
                score += 10;
            } else if (data.education.length > 0) {
                suggestions.push('Complete all education fields (degree, school, year).');
            }

            return {
                score: Math.min(score, 100),
                suggestions: suggestions.slice(0, 3) // Max 3 suggestions
            };
        }

        function loadSampleData() {
            const sample = {
                personal: {
                    name: 'Alex Johnson',
                    email: 'alex.johnson@email.com',
                    phone: '+1 (555) 123-4567',
                    location: 'San Francisco, CA'
                },
                summary: 'Full-stack developer with 3+ years of experience building scalable web applications. Passionate about clean code, user experience, and solving complex problems. Specialized in React, Node.js, and cloud infrastructure.',
                education: [
                    {
                        degree: 'B.S. Computer Science',
                        school: 'Stanford University',
                        year: '2020',
                        gpa: '3.8/4.0'
                    }
                ],
                experience: [
                    {
                        title: 'Software Engineer',
                        company: 'Tech Corp',
                        duration: '2021 - Present',
                        description: 'Built microservices architecture serving 1M+ users. Reduced API latency by 40% through optimization. Led team of 3 engineers.'
                    },
                    {
                        title: 'Junior Developer',
                        company: 'Startup Inc',
                        duration: '2020 - 2021',
                        description: 'Developed React components for customer dashboard. Implemented CI/CD pipeline reducing deployment time by 60%.'
                    }
                ],
                projects: [
                    {
                        name: 'AI Chat Platform',
                        tech: ['React', 'Node.js', 'OpenAI API'],
                        description: 'Built real-time chat application with AI-powered responses. 10k+ active users, 95% uptime.',
                        liveUrl: 'https://chat-ai.example.com',
                        githubUrl: 'https://github.com/alexjohnson/ai-chat',
                        isCollapsed: true
                    },
                    {
                        name: 'E-commerce Analytics',
                        tech: ['Python', 'PostgreSQL', 'AWS'],
                        description: 'Created analytics dashboard processing 500k+ transactions daily. Improved reporting speed by 3x.',
                        liveUrl: '',
                        githubUrl: 'https://github.com/alexjohnson/ecommerce-stats',
                        isCollapsed: true
                    }
                ],
                skills: {
                    technical: ['JavaScript', 'React', 'Node.js', 'Python', 'TypeScript', 'SQL', 'MongoDB'],
                    soft: ['Problem Solving', 'Teamwork'],
                    tools: ['AWS', 'Docker', 'Git']
                },
                links: {
                    github: 'github.com/alexjohnson',
                    linkedin: 'linkedin.com/in/alexjohnson'
                }
            };
            saveResumeData(sample);
        }

        // Helper functions for Skills & Projects interaction
        let isSuggestingSkills = false;
        function suggestSkills() {
            if (isSuggestingSkills) return;
            isSuggestingSkills = true;
            render(); // Show loading state

            setTimeout(() => {
                const data = getResumeData();
                const suggestions = {
                    technical: ["TypeScript", "React", "Node.js", "PostgreSQL", "GraphQL"],
                    soft: ["Team Leadership", "Problem Solving"],
                    tools: ["Git", "Docker", "AWS"]
                };

                // Add unique suggestions
                Object.keys(suggestions).forEach(cat => {
                    suggestions[cat].forEach(skill => {
                        if (!data.skills[cat].includes(skill)) {
                            data.skills[cat].push(skill);
                        }
                    });
                });

                isSuggestingSkills = false;
                saveResumeData(data);
            }, 1000);
        }

        function addSkill(category, skill) {
            if (!skill.trim()) return;
            const data = getResumeData();
            if (!data.skills[category].includes(skill.trim())) {
                data.skills[category].push(skill.trim());
                saveResumeData(data);
            }
        }

        function removeSkill(category, index) {
            const data = getResumeData();
            data.skills[category].splice(index, 1);
            saveResumeData(data);
        }

        function addProjectTech(projectIndex, tech) {
            if (!tech.trim()) return;
            const data = getResumeData();
            if (!data.projects[projectIndex].tech.includes(tech.trim())) {
                data.projects[projectIndex].tech.push(tech.trim());
                saveResumeData(data);
            }
        }

        function removeProjectTech(projectIndex, techIndex) {
            const data = getResumeData();
            data.projects[projectIndex].tech.splice(techIndex, 1);
            saveResumeData(data);
        }

        function toggleProjectAccordion(index) {
            const data = getResumeData();
            data.projects[index].isCollapsed = !data.projects[index].isCollapsed;
            saveResumeData(data);
        }

        // Helper functions for managing sections
        function addEducation() {
            const data = getResumeData();
            data.education.push({ degree: '', school: '', year: '', gpa: '' });
            saveResumeData(data);
        }

        function removeEducation(index) {
            const data = getResumeData();
            data.education.splice(index, 1);
            saveResumeData(data);
        }

        function updateEducation(index, field, value) {
            const data = getResumeData();
            data.education[index][field] = value;
            saveResumeData(data);
        }

        function addExperience() {
            const data = getResumeData();
            data.experience.push({ title: '', company: '', duration: '', description: '' });
            saveResumeData(data);
        }

        function removeExperience(index) {
            const data = getResumeData();
            data.experience.splice(index, 1);
            saveResumeData(data);
        }

        function updateExperience(index, field, value) {
            const data = getResumeData();
            data.experience[index][field] = value;
            saveResumeData(data);
        }

        function addProject() {
            const data = getResumeData();
            data.projects.push({ name: '', tech: '', description: '' });
            saveResumeData(data);
        }

        function removeProject(index) {
            const data = getResumeData();
            data.projects.splice(index, 1);
            saveResumeData(data);
        }

        function updateProject(index, field, value) {
            const data = getResumeData();
            data.projects[index][field] = value;
            saveResumeData(data);
        }

        // Template management
        function getTemplate() {
            return localStorage.getItem('resumeTemplate') || 'classic';
        }

        function setTemplate(template) {
            localStorage.setItem('resumeTemplate', template);
            render();
        }

        function getThemeColor() {
            return localStorage.getItem('resumeThemeColor') || 'hsl(168, 60%, 40%)';
        }

        function setThemeColor(color) {
            localStorage.setItem('resumeThemeColor', color);
            render();
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-8 left-1/2 -translate-x-1/2 px-6 py-3 bg-slate-900 text-white text-sm font-medium rounded-full shadow-2xl z-[9999] transition-all duration-300 opacity-0 translate-y-4';
            toast.textContent = message;
            document.body.appendChild(toast);

            // Animate in
            requestAnimationFrame(() => {
                toast.classList.remove('opacity-0', 'translate-y-4');
            });

            // Animate out and remove
            setTimeout(() => {
                toast.classList.add('opacity-0', 'translate-y-4');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Bullet guidance helpers
        const ACTION_VERBS = ['built', 'developed', 'designed', 'implemented', 'led', 'improved', 'created', 'optimized', 'automated', 'managed', 'launched', 'reduced', 'increased', 'established', 'achieved', 'delivered', 'executed', 'streamlined', 'spearheaded', 'coordinated'];

        function checkBulletGuidance(text) {
            const guidance = [];
            if (!text || text.trim().length === 0) return guidance;

            const firstWord = text.trim().split(/\s+/)[0].toLowerCase().replace(/[^a-z]/g, '');
            if (!ACTION_VERBS.includes(firstWord)) {
                guidance.push('Start with a strong action verb.');
            }

            if (!/\d+[%kKmM]?|\d+\+|[0-9]/.test(text)) {
                guidance.push('Add measurable impact (numbers).');
            }

            return guidance;
        }

        function getTopImprovements(data) {
            const improvements = [];

            if (data.projects.length < 2) {
                improvements.push('Add at least 2 projects to showcase your work');
            }

            const hasNumbers = [...data.experience, ...data.projects].some(item => {
                const desc = item.description || '';
                return /\d+[%kKmM]?|\d+\+|[0-9]/.test(desc);
            });
            if (!hasNumbers && (data.experience.length > 0 || data.projects.length > 0)) {
                improvements.push('Add measurable impact with numbers and metrics');
            }

            const summaryWords = data.summary.trim().split(/\s+/).filter(w => w.length > 0).length;
            if (summaryWords < 40) {
                improvements.push('Expand your summary to 40-120 words');
            }

            const skillsArray = data.skills.split(',').map(s => s.trim()).filter(s => s.length > 0);
            if (skillsArray.length < 8) {
                improvements.push('Add more skills (target 8+ items)');
            }

            if (data.experience.length === 0) {
                improvements.push('Add work experience or internships');
            }

            return improvements.slice(0, 3);
        }

        function getValidationWarnings(data) {
            const warnings = [];
            if (!data.personal.name.trim()) {
                warnings.push('Your name is missing.');
            }
            if (data.experience.length === 0 && data.projects.length === 0) {
                warnings.push('Add at least one experience or project entry.');
            }
            return warnings;
        }

        function copyResumeAsText() {
            const data = getResumeData();
            let text = `${data.personal.name.toUpperCase()}\n`;
            text += `${data.personal.email} | ${data.personal.phone} | ${data.personal.location}\n`;
            if (data.links.github || data.links.linkedin) {
                text += `${data.links.github} ${data.links.linkedin}\n`;
            }
            text += `\nSUMMARY\n${data.summary}\n`;

            if (data.education.length > 0) {
                text += `\nEDUCATION\n`;
                data.education.forEach(edu => {
                    text += `${edu.degree} - ${edu.school} (${edu.year})\n`;
                    if (edu.gpa) text += `GPA: ${edu.gpa}\n`;
                });
            }

            if (data.experience.length > 0) {
                text += `\nEXPERIENCE\n`;
                data.experience.forEach(exp => {
                    text += `${exp.title} | ${exp.company} | ${exp.duration}\n`;
                    text += `${exp.description}\n\n`;
                });
            }

            if (data.projects.length > 0) {
                text += `\nPROJECTS\n`;
                data.projects.forEach(proj => {
                    text += `${proj.name} | ${proj.tech.join(', ')}\n`;
                    if (proj.liveUrl) text += `Live: ${proj.liveUrl}\n`;
                    if (proj.githubUrl) text += `Code: ${proj.githubUrl}\n`;
                    text += `${proj.description}\n\n`;
                });
            }

            if (Object.values(data.skills).some(cat => cat.length > 0)) {
                text += `\nSKILLS\n`;
                Object.entries(data.skills).forEach(([cat, skills]) => {
                    if (skills.length > 0) {
                        text += `${cat.toUpperCase()}: ${skills.join(', ')}\n`;
                    }
                });
            }

            navigator.clipboard.writeText(text).then(() => {
                alert('Resume copied to clipboard as plain text!');
            }).catch(err => {
                console.error('Failed to copy text: ', err);
            });
        }

        function renderResumeHome() {
            return `
                <div class="min-h-screen flex flex-col bg-white">
                    <nav class="border-b border-slate-200 px-8 py-4">
                        <div class="max-w-6xl mx-auto flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                ${Icon('layout')}
                                <span class="font-bold text-lg">AI Resume Builder</span>
                            </div>
                            <button onclick="navigate('/')" class="text-sm text-slate-600 hover:text-primary">← Back to Platform</button>
                        </div>
                    </nav>

                    <main class="flex-1 flex flex-col items-center justify-center px-4 py-20 bg-gradient-to-b from-slate-50 to-white">
                        <div class="text-center max-w-3xl">
                            <h1 class="text-6xl font-serif font-bold text-slate-900 mb-6">
                                Build a Resume<br/>That Gets <span class="text-primary">Read</span>
                            </h1>
                            <p class="text-xl text-slate-600 mb-10 leading-relaxed">
                                Create a professional, ATS-optimized resume in minutes.<br/>
                                Clean design. Premium typography. Zero fluff.
                            </p>
                            <button onclick="navigate('/resume/builder')" class="px-10 py-4 bg-primary text-white rounded-lg text-lg font-bold hover:bg-primary-dark transition-all shadow-lg hover:shadow-xl">
                                Start Building
                            </button>
                        </div>
                    </main>
                </div>
            `;
        }

        function renderResumeBuilder() {
            const data = getResumeData();
            const template = getTemplate();
            const themeColor = getThemeColor();

            return `
                <div class="min-h-screen flex flex-col bg-slate-50">
                    <nav class="bg-white border-b border-slate-200 px-8 py-4 sticky top-0 z-50">
                        <div class="max-w-7xl mx-auto flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                ${Icon('layout')}
                                <span class="font-bold text-lg">AI Resume Builder</span>
                            </div>
                            <div class="flex gap-6 text-sm font-medium">
                                <a href="#/resume/builder" class="text-primary border-b-2 border-primary pb-1">Builder</a>
                                <a href="#/resume/preview" class="text-slate-600 hover:text-primary transition-colors">Preview</a>
                                <a href="#/resume/proof" class="text-slate-600 hover:text-primary transition-colors">Proof</a>
                            </div>
                        </div>
                    </nav>

                    <!-- Template & Color Picker -->
                    <div class="bg-white border-b border-slate-100 px-8 py-6">
                        <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8">
                            <!-- Template Picker -->
                            <div class="space-y-4">
                                <div class="flex items-center gap-2">
                                    <span class="text-xs font-bold text-slate-500 uppercase tracking-widest">Select Template</span>
                                </div>
                                <div class="flex gap-4">
                                    ${['classic', 'modern', 'minimal'].map(t => {
                const isActive = getTemplate() === t;
                return `
                                            <div onclick="setTemplate('${t}')" 
                                                class="group cursor-pointer space-y-2">
                                                <div class="w-[120px] h-[150px] rounded-lg border-2 transition-all p-2 bg-slate-50 relative ${isActive ? 'border-primary ring-2 ring-primary/10 shadow-md' : 'border-slate-200 hover:border-slate-300'}">
                                                    <!-- active checkmark -->
                                                    ${isActive ? `
                                                        <div class="absolute top-1 right-1 bg-primary text-white rounded-full p-0.5 z-10">
                                                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/></svg>
                                                        </div>
                                                    ` : ''}
                                                    
                                                    <!-- Visual Sketch -->
                                                    <div class="w-full h-full border border-slate-200 bg-white rounded flex flex-col p-1.5 gap-1.5 overflow-hidden">
                                                        ${t === 'classic' ? `
                                                            <div class="w-full h-2 bg-slate-200 rounded-sm"></div>
                                                            <div class="flex justify-center gap-1"><div class="w-1/3 h-1 bg-slate-100"></div><div class="w-1/3 h-1 bg-slate-100"></div></div>
                                                            <div class="w-full h-[1px] bg-slate-200 mt-1"></div>
                                                            <div class="space-y-1">
                                                                <div class="w-1/4 h-1.5 bg-slate-200"></div>
                                                                <div class="w-full h-1 bg-slate-50"></div>
                                                                <div class="w-full h-1 bg-slate-50"></div>
                                                            </div>
                                                        ` : t === 'modern' ? `
                                                            <div class="flex h-full gap-2">
                                                                <div class="w-1/3 h-full bg-primary/10 rounded-sm p-1 space-y-1">
                                                                    <div class="w-full h-1 bg-primary/20"></div>
                                                                    <div class="w-full h-1 bg-primary/20"></div>
                                                                </div>
                                                                <div class="flex-1 space-y-1.5">
                                                                    <div class="w-2/3 h-2 bg-slate-200"></div>
                                                                    <div class="w-full h-1 bg-slate-50"></div>
                                                                    <div class="w-full h-1 bg-slate-50"></div>
                                                                </div>
                                                            </div>
                                                        ` : `
                                                            <div class="w-2/3 h-3 bg-slate-200 rounded-sm mb-2"></div>
                                                            <div class="space-y-2">
                                                                <div class="w-1/4 h-1 bg-slate-400/20"></div>
                                                                <div class="w-full h-1 bg-slate-100"></div>
                                                                <div class="w-full h-1 bg-slate-100"></div>
                                                            </div>
                                                        `}
                                                    </div>
                                                </div>
                                                <span class="block text-center text-xs font-semibold capitalize ${isActive ? 'text-primary' : 'text-slate-500'}">${t}</span>
                                            </div>
                                        `;
            }).join('')}
                                </div>
                            </div>

                            <!-- Color Theme Picker -->
                            <div class="space-y-4">
                                <div class="flex items-center gap-2">
                                    <span class="text-xs font-bold text-slate-500 uppercase tracking-widest">Theme Color</span>
                                </div>
                                <div class="flex items-center gap-3">
                                    ${[
                    { name: 'Teal', color: 'hsl(168, 60%, 40%)' },
                    { name: 'Navy', color: 'hsl(220, 60%, 35%)' },
                    { name: 'Burgundy', color: 'hsl(345, 60%, 35%)' },
                    { name: 'Forest', color: 'hsl(150, 50%, 30%)' },
                    { name: 'Charcoal', color: 'hsl(0, 0%, 25%)' }
                ].map(c => `
                                        <button 
                                            onclick="setThemeColor('${c.color}')"
                                            title="${c.name}"
                                            class="w-8 h-8 rounded-full transition-all flex items-center justify-center ${getThemeColor() === c.color ? 'ring-2 ring-offset-2 ring-primary scale-110 shadow-lg' : 'hover:scale-110'}"
                                            style="background-color: ${c.color}">
                                            ${getThemeColor() === c.color ? `<svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/></svg>` : ''}
                                        </button>
                                    `).join('')}
                                </div>
                                <p class="text-[10px] text-slate-400">Selecting a color updates headers, borders, and sidebar backgrounds.</p>
                            </div>
                        </div>
                    </div>

                    <main class="flex-1 max-w-7xl mx-auto w-full px-8 py-8">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 h-full">
                            <!-- Left: Form -->
                            <div class="space-y-6 overflow-y-auto">
                                <div class="flex justify-between items-center">
                                    <h2 class="text-2xl font-bold text-slate-900">Build Your Resume</h2>
                                    <button onclick="loadSampleData()" class="px-4 py-2 text-sm border border-slate-300 rounded-lg hover:bg-slate-50 text-slate-700">
                                        Load Sample Data
                                    </button>
                                </div>

                                <!-- Personal Info -->
                                <div class="bg-white rounded-xl border border-slate-200 p-6">
                                    <h3 class="font-bold text-slate-900 mb-4">Personal Information</h3>
                                    <div class="space-y-4">
                                        <input type="text" placeholder="Full Name" value="${data.personal.name}" 
                                            oninput="const d = getResumeData(); d.personal.name = this.value; saveResumeData(d);"
                                            class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none">
                                        <input type="email" placeholder="Email" value="${data.personal.email}"
                                            oninput="const d = getResumeData(); d.personal.email = this.value; saveResumeData(d);"
                                            class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none">
                                        <input type="tel" placeholder="Phone" value="${data.personal.phone}"
                                            oninput="const d = getResumeData(); d.personal.phone = this.value; saveResumeData(d);"
                                            class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none">
                                        <input type="text" placeholder="Location" value="${data.personal.location}"
                                            oninput="const d = getResumeData(); d.personal.location = this.value; saveResumeData(d);"
                                            class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none">
                                    </div>
                                </div>

                                <!-- Summary -->
                                <div class="bg-white rounded-xl border border-slate-200 p-6">
                                    <h3 class="font-bold text-slate-900 mb-4">Professional Summary</h3>
                                    <textarea placeholder="Brief overview of your experience and skills..." 
                                        oninput="const d = getResumeData(); d.summary = this.value; saveResumeData(d);"
                                        class="w-full h-32 px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none resize-none">${data.summary}</textarea>
                                </div>

                                <!-- Skills -->
                                <div class="bg-white rounded-xl border border-slate-200 p-6">
                                    <div class="flex justify-between items-center mb-6">
                                        <h3 class="font-bold text-slate-900">Skills</h3>
                                        <button onclick="suggestSkills()" 
                                            class="px-4 py-2 text-sm bg-indigo-50 text-indigo-700 rounded-lg hover:bg-indigo-100 transition-colors flex items-center gap-2 ${isSuggestingSkills ? 'opacity-50 cursor-not-allowed' : ''}">
                                            ${isSuggestingSkills ? Icon('loader', 'animate-spin w-4 h-4') : '✨'}
                                            ${isSuggestingSkills ? 'Suggesting...' : 'Suggest Skills'}
                                        </button>
                                    </div>

                                    <div class="space-y-6">
                                        ${[
                    { key: 'technical', label: 'Technical Skills' },
                    { key: 'soft', label: 'Soft Skills' },
                    { key: 'tools', label: 'Tools & Technologies' }
                ].map(cat => `
                                            <div class="space-y-3">
                                                <div class="flex justify-between items-center">
                                                    <label class="text-xs font-bold text-slate-500 uppercase tracking-wider">${cat.label} (${data.skills[cat.key].length})</label>
                                                </div>
                                                <div class="flex flex-wrap gap-2 p-3 border border-slate-200 rounded-lg focus-within:ring-2 focus-within:ring-primary focus-within:border-transparent min-h-[46px] bg-slate-50/30">
                                                    ${data.skills[cat.key].map((skill, idx) => `
                                                        <span class="flex items-center gap-1.5 px-2.5 py-1 bg-white border border-slate-200 text-slate-700 rounded-md text-xs font-medium shadow-sm">
                                                            ${skill}
                                                            <button onclick="removeSkill('${cat.key}', ${idx})" class="text-slate-400 hover:text-red-500 transition-colors">
                                                                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                                                            </button>
                                                        </span>
                                                    `).join('')}
                                                    <input type="text" 
                                                        placeholder="Type and press Enter..." 
                                                        class="flex-1 bg-transparent border-none focus:ring-0 text-sm p-0 min-w-[120px]"
                                                        onkeydown="if(event.key === 'Enter') { addSkill('${cat.key}', this.value); this.value = ''; }">
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>

                                <!-- Links -->
                                <div class="bg-white rounded-xl border border-slate-200 p-6">
                                    <h3 class="font-bold text-slate-900 mb-4">Links</h3>
                                    <div class="space-y-4">
                                        <input type="text" placeholder="GitHub URL" value="${data.links.github}"
                                            oninput="const d = getResumeData(); d.links.github = this.value; saveResumeData(d);"
                                            class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none">
                                        <input type="text" placeholder="LinkedIn URL" value="${data.links.linkedin}"
                                            oninput="const d = getResumeData(); d.links.linkedin = this.value; saveResumeData(d);"
                                            class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none">
                                    </div>
                                </div>

                                <!-- Education -->
                                <div class="bg-white rounded-xl border border-slate-200 p-6">
                                    <div class="flex justify-between items-center mb-4">
                                        <h3 class="font-bold text-slate-900">Education</h3>
                                        <button onclick="addEducation()" class="px-3 py-1 text-sm bg-primary text-white rounded-lg hover:bg-primary-dark">
                                            + Add
                                        </button>
                                    </div>
                                    ${data.education.map((edu, i) => `
                                        <div class="mb-4 pb-4 border-b border-slate-100 last:border-0">
                                            <div class="flex justify-between items-start mb-3">
                                                <span class="text-xs font-bold text-slate-400">Entry ${i + 1}</span>
                                                <button onclick="removeEducation(${i})" class="text-xs text-red-500 hover:text-red-700">Remove</button>
                                            </div>
                                            <div class="space-y-3">
                                                <input type="text" placeholder="Degree (e.g., B.S. Computer Science)" value="${edu.degree || ''}"
                                                    oninput="updateEducation(${i}, 'degree', this.value)"
                                                    class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none text-sm">
                                                <input type="text" placeholder="School/University" value="${edu.school || ''}"
                                                    oninput="updateEducation(${i}, 'school', this.value)"
                                                    class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none text-sm">
                                                <div class="grid grid-cols-2 gap-3">
                                                    <input type="text" placeholder="Year" value="${edu.year || ''}"
                                                        oninput="updateEducation(${i}, 'year', this.value)"
                                                        class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none text-sm">
                                                    <input type="text" placeholder="GPA (optional)" value="${edu.gpa || ''}"
                                                        oninput="updateEducation(${i}, 'gpa', this.value)"
                                                        class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none text-sm">
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                    ${data.education.length === 0 ? '<p class="text-sm text-slate-400 text-center py-4">No education entries yet</p>' : ''}
                                </div>

                                <!-- Experience -->
                                <div class="bg-white rounded-xl border border-slate-200 p-6">
                                    <div class="flex justify-between items-center mb-4">
                                        <h3 class="font-bold text-slate-900">Experience</h3>
                                        <button onclick="addExperience()" class="px-3 py-1 text-sm bg-primary text-white rounded-lg hover:bg-primary-dark">
                                            + Add
                                        </button>
                                    </div>
                                    ${data.experience.map((exp, i) => `
                                        <div class="mb-4 pb-4 border-b border-slate-100 last:border-0">
                                            <div class="flex justify-between items-start mb-3">
                                                <span class="text-xs font-bold text-slate-400">Entry ${i + 1}</span>
                                                <button onclick="removeExperience(${i})" class="text-xs text-red-500 hover:text-red-700">Remove</button>
                                            </div>
                                            <div class="space-y-3">
                                                <input type="text" placeholder="Job Title" value="${exp.title || ''}"
                                                    oninput="updateExperience(${i}, 'title', this.value)"
                                                    class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none text-sm">
                                                <input type="text" placeholder="Company" value="${exp.company || ''}"
                                                    oninput="updateExperience(${i}, 'company', this.value)"
                                                    class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none text-sm">
                                                <input type="text" placeholder="Duration (e.g., 2021 - Present)" value="${exp.duration || ''}"
                                                    oninput="updateExperience(${i}, 'duration', this.value)"
                                                    class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none text-sm">
                                                <textarea placeholder="Description (include metrics!)" 
                                                    oninput="updateExperience(${i}, 'description', this.value)"
                                                    class="w-full h-24 px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none resize-none text-sm">${exp.description || ''}</textarea>
                                                ${(() => {
                        const guidance = checkBulletGuidance(exp.description || '');
                        return guidance.length > 0 ? `
                                                        <div class="text-xs text-amber-600 space-y-1">
                                                            ${guidance.map(g => `<div>💡 ${g}</div>`).join('')}
                                                        </div>
                                                    ` : '';
                    })()}
                                            </div>
                                        </div>
                                    `).join('')}
                                    ${data.experience.length === 0 ? '<p class="text-sm text-slate-400 text-center py-4">No experience entries yet</p>' : ''}
                                </div>

                                <!-- Projects -->
                                <div class="bg-white rounded-xl border border-slate-200 p-6">
                                    <div class="flex justify-between items-center mb-6">
                                        <h3 class="font-bold text-slate-900">Projects</h3>
                                        <button onclick="addProject()" class="px-4 py-2 text-sm bg-primary text-white rounded-lg hover:bg-primary-dark shadow-sm transition-all flex items-center gap-2">
                                            ${Icon('plus')} Add Project
                                        </button>
                                    </div>

                                    <div class="space-y-4">
                                        ${data.projects.map((proj, i) => `
                                            <div class="border border-slate-200 rounded-xl overflow-hidden bg-white shadow-sm transition-all hover:border-slate-300">
                                                <div class="flex items-center justify-between p-4 cursor-pointer bg-slate-50/50 hover:bg-slate-50 transition-colors" onclick="toggleProjectAccordion(${i})">
                                                    <div class="flex items-center gap-3">
                                                        <div class="p-2 bg-indigo-50 text-indigo-600 rounded-lg">
                                                            ${Icon('briefcase', 'w-4 h-4')}
                                                        </div>
                                                        <div>
                                                            <h4 class="font-bold text-slate-900">${proj.name || 'Untitled Project'}</h4>
                                                            <p class="text-xs text-slate-500">${proj.tech.length} Technologies</p>
                                                        </div>
                                                    </div>
                                                    <div class="flex items-center gap-3">
                                                        <button onclick="event.stopPropagation(); removeProject(${i})" class="p-2 text-slate-400 hover:text-red-500 transition-colors">
                                                            ${Icon('trash', 'w-4 h-4')}
                                                        </button>
                                                        <div class="p-1 transition-transform ${!proj.isCollapsed ? 'rotate-180' : ''}">
                                                            ${Icon('chevron-down', 'w-5 h-5')}
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="${proj.isCollapsed ? 'hidden' : 'block'} p-6 border-t border-slate-100 space-y-5">
                                                    <div class="space-y-4">
                                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                            <div class="space-y-1.5">
                                                                <label class="text-xs font-bold text-slate-500 uppercase">Project Title</label>
                                                                <input type="text" placeholder="e.g. AI Portfolio Platform" value="${proj.name || ''}"
                                                                    oninput="updateProject(${i}, 'name', this.value)"
                                                                    class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none text-sm">
                                                            </div>
                                                            <div class="space-y-1.5">
                                                                <label class="text-xs font-bold text-slate-500 uppercase">Tech Stack (Tag Input)</label>
                                                                <div class="flex flex-wrap gap-2 p-2 border border-slate-200 rounded-lg min-h-[42px] bg-slate-50/30">
                                                                    ${proj.tech.map((t, tidx) => `
                                                                        <span class="flex items-center gap-1.5 px-2 py-0.5 bg-white border border-slate-200 text-slate-700 rounded text-xs font-medium">
                                                                            ${t}
                                                                            <button onclick="removeProjectTech(${i}, ${tidx})" class="text-slate-400 hover:text-red-500">
                                                                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                                                                            </button>
                                                                        </span>
                                                                    `).join('')}
                                                                    <input type="text" placeholder="Add tech..." 
                                                                        class="flex-1 bg-transparent border-none focus:ring-0 text-sm p-0 min-w-[80px]"
                                                                        onkeydown="if(event.key === 'Enter') { addProjectTech(${i}, this.value); this.value = ''; }">
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="space-y-1.5">
                                                            <div class="flex justify-between items-center">
                                                                <label class="text-xs font-bold text-slate-500 uppercase">Description</label>
                                                                <span class="text-[10px] font-medium ${(proj.description || '').length > 200 ? 'text-red-500' : 'text-slate-400'}">${(proj.description || '').length}/200</span>
                                                            </div>
                                                            <textarea placeholder="Describe the impact, features, and your role..." 
                                                                maxlength="200"
                                                                oninput="updateProject(${i}, 'description', this.value)"
                                                                class="w-full h-24 px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none resize-none text-sm">${proj.description || ''}</textarea>
                                                        </div>

                                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                            <div class="space-y-1.5">
                                                                <label class="text-xs font-bold text-slate-500 uppercase">Live URL (Optional)</label>
                                                                <input type="text" placeholder="https://..." value="${proj.liveUrl || ''}"
                                                                    oninput="updateProject(${i}, 'liveUrl', this.value)"
                                                                    class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none text-sm">
                                                            </div>
                                                            <div class="space-y-1.5">
                                                                <label class="text-xs font-bold text-slate-500 uppercase">GitHub URL (Optional)</label>
                                                                <input type="text" placeholder="https://..." value="${proj.githubUrl || ''}"
                                                                    oninput="updateProject(${i}, 'githubUrl', this.value)"
                                                                    class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none text-sm">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        `).join('')}
                                        ${data.projects.length === 0 ? '<p class="text-sm text-slate-400 text-center py-10 bg-slate-50 rounded-xl border-2 border-dashed border-slate-100">Click "+" to add your first project entry.</p>' : ''}
                                    </div>
                                </div>
                            </div>

                            <!-- Right: Live Preview with ATS Score -->
                            <div class="space-y-6">
                                <!-- ATS Score Card -->
                                <div class="bg-white rounded-xl border border-slate-200 p-6 sticky top-24 shadow-sm">
                                    ${(() => {
                    const atsResult = calculateATSScore(data);
                    const scoreColor = atsResult.score >= 80 ? 'emerald' : atsResult.score >= 60 ? 'amber' : 'red';
                    return `
                                            <div class="text-center mb-4">
                                                <h3 class="text-sm font-bold text-slate-600 uppercase tracking-wider mb-3">ATS Readiness Score</h3>
                                                <div class="relative w-32 h-32 mx-auto mb-4">
                                                    <svg class="transform -rotate-90 w-32 h-32">
                                                        <circle cx="64" cy="64" r="56" stroke="#e2e8f0" stroke-width="8" fill="none" />
                                                        <circle cx="64" cy="64" r="56" 
                                                            stroke="${scoreColor === 'emerald' ? '#10b981' : scoreColor === 'amber' ? '#f59e0b' : '#ef4444'}" 
                                                            stroke-width="8" 
                                                            fill="none"
                                                            stroke-dasharray="${2 * Math.PI * 56}"
                                                            stroke-dashoffset="${2 * Math.PI * 56 * (1 - atsResult.score / 100)}"
                                                            stroke-linecap="round"
                                                            class="transition-all duration-500" />
                                                    </svg>
                                                    <div class="absolute inset-0 flex items-center justify-center">
                                                        <span class="text-4xl font-bold text-slate-900">${atsResult.score}</span>
                                                    </div>
                                                </div>
                                                <p class="text-xs text-slate-500">Out of 100</p>
                                            </div>
                                            ${atsResult.suggestions.length > 0 ? `
                                                <div class="mt-4 pt-4 border-t border-slate-100">
                                                    <h4 class="text-xs font-bold text-slate-600 uppercase tracking-wider mb-2">Suggestions</h4>
                                                    <ul class="space-y-2">
                                                        ${atsResult.suggestions.map(s => `
                                                            <li class="text-xs text-slate-600 flex items-start gap-2">
                                                                <span class="text-amber-500 mt-0.5">•</span>
                                                                <span>${s}</span>
                                                            </li>
                                                        `).join('')}
                                                    </ul>
                                                </div>
                                            ` : `
                                                <div class="mt-4 pt-4 border-t border-slate-100">
                                                    <p class="text-xs text-emerald-600 font-medium">✓ Perfect score! Your resume is ATS-ready.</p>
                                                </div>
                                            `}
                                            
                                            <!-- Improvement Panel -->
                                            ${(() => {
                            const improvements = getTopImprovements(data);
                            return improvements.length > 0 ? `
                                                    <div class="mt-4 pt-4 border-t border-slate-100">
                                                        <h4 class="text-xs font-bold text-slate-600 uppercase tracking-wider mb-2">Top 3 Improvements</h4>
                                                        <ul class="space-y-2">
                                                            ${improvements.map((imp, idx) => `
                                                                <li class="text-xs text-slate-600 flex items-start gap-2">
                                                                    <span class="text-primary font-bold">${idx + 1}.</span>
                                                                    <span>${imp}</span>
                                                                </li>
                                                            `).join('')}
                                                        </ul>
                                                    </div>
                                                ` : '';
                        })()}
                                        `;
                })()}
                                </div>

                                <!-- Resume Preview -->
                                <div class="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
                                    <div class="p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                                        <span class="text-[10px] font-bold uppercase tracking-widest text-slate-400">Live Preview (${template.charAt(0).toUpperCase() + template.slice(1)})</span>
                                        <div class="flex gap-1">
                                            <div class="w-2 h-2 rounded-full" style="background-color: ${themeColor}"></div>
                                        </div>
                                    </div>
                                    <div class="p-4 transform origin-top scale-[0.85] -mb-[15%]">
                                        ${renderResumeContent(data, template, themeColor)}
                                    </div>
                                    <div class="text-center text-[10px] text-slate-400 py-4 border-t border-slate-100 bg-white">
                                        Updates automatically
                                    </div>
                                </div>
                            </div>
                        </div>
                    </main>
                </div>
            `;
        }

        function getTemplateStyles(template, themeColor) {
            return {
                classic: {
                    container: 'font-serif',
                    header: `text-center mb-8 pb-6 border-b-2`,
                    headerBorder: `border-slate-900`,
                    name: 'text-4xl font-serif font-bold text-slate-900 mb-3 uppercase tracking-tight',
                    sectionTitle: `text-xs font-bold uppercase tracking-widest mb-4 border-b pb-1`,
                    sectionTitleColor: `text-slate-900 border-slate-900`,
                    text: 'text-sm text-slate-800 leading-relaxed',
                    accentColor: themeColor
                },
                modern: {
                    container: 'font-sans flex gap-0 min-h-full',
                    sidebar: `w-1/3 p-8 text-white`,
                    sidebarBg: themeColor,
                    main: 'flex-1 p-8 bg-white',
                    name: 'text-4xl font-bold text-slate-900 mb-2',
                    sectionTitle: `text-sm font-bold uppercase tracking-wider mb-4 flex items-center gap-2`,
                    sectionTitleColor: `text-primary`,
                    text: 'text-sm text-slate-700 leading-relaxed',
                    accentColor: themeColor
                },
                minimal: {
                    container: 'font-sans px-12 py-16',
                    header: 'text-left mb-16',
                    name: 'text-5xl font-light text-slate-900 mb-6 tracking-tighter',
                    sectionTitle: 'text-[10px] font-bold uppercase tracking-[0.2em] text-slate-400 mb-6',
                    text: 'text-sm text-slate-600 leading-loose',
                    accentColor: themeColor
                }
            }[template];
        }

        function renderResumeContent(data, template, themeColor) {
            const styles = getTemplateStyles(template, themeColor);

            const renderContactInfo = () => `
                <div class="space-y-2 text-xs opacity-90">
                    <div class="flex items-center gap-2">${Icon('mail', 'w-3 h-3')} ${data.personal.email || 'email@example.com'}</div>
                    ${data.personal.phone ? `<div class="flex items-center gap-2">${Icon('phone', 'w-3 h-3')} ${data.personal.phone}</div>` : ''}
                    ${data.personal.location ? `<div class="flex items-center gap-2">${Icon('map-pin', 'w-3 h-3')} ${data.personal.location}</div>` : ''}
                    ${data.links.github ? `<div class="flex items-center gap-2">${Icon('github', 'w-3 h-3')} ${data.links.github}</div>` : ''}
                    ${data.links.linkedin ? `<div class="flex items-center gap-2">${Icon('linkedin', 'w-3 h-3')} ${data.links.linkedin}</div>` : ''}
                </div>
            `;

            const renderSkillsList = (isSidebar = false) => {
                if (!Object.values(data.skills).some(cat => cat.length > 0)) return '';
                return `
                    <div class="${isSidebar ? 'mt-8' : 'mb-8'}">
                        <h2 class="${styles.sectionTitle}" style="${template === 'classic' ? `color: ${styles.accentColor}; border-color: ${styles.accentColor};` : template === 'modern' ? `color: ${isSidebar ? 'white' : styles.accentColor};` : ''}">Skills</h2>
                        <div class="space-y-4">
                            ${Object.entries(data.skills).map(([cat, skills]) => skills.length > 0 ? `
                                <div>
                                    <div class="text-[10px] font-bold ${isSidebar ? 'text-white/60' : 'text-slate-400'} uppercase tracking-widest mb-1.5">${cat}</div>
                                    <div class="flex flex-wrap gap-1.5">
                                        ${skills.map(s => `<span class="px-2 py-0.5 ${isSidebar ? 'bg-white/10 text-white' : 'bg-slate-50 text-slate-700'} rounded border ${isSidebar ? 'border-white/10' : 'border-slate-100'} text-[10px] font-medium">${s}</span>`).join('')}
                                    </div>
                                </div>
                            ` : '').join('')}
                        </div>
                    </div>
                `;
            };

            const renderMainSections = () => `
                <!-- Summary -->
                ${data.summary ? `
                    <div class="mb-8">
                        <h2 class="${styles.sectionTitle}" style="${template === 'classic' ? `color: ${styles.accentColor}; border-color: ${styles.accentColor};` : template === 'modern' ? `color: ${styles.accentColor};` : ''}">Professional Summary</h2>
                        <p class="${styles.text}">${data.summary}</p>
                    </div>
                ` : ''}

                <!-- Experience -->
                ${data.experience.length > 0 ? `
                    <div class="mb-8">
                        <h2 class="${styles.sectionTitle}" style="${template === 'classic' ? `color: ${styles.accentColor}; border-color: ${styles.accentColor};` : template === 'modern' ? `color: ${styles.accentColor};` : ''}">Experience</h2>
                        ${data.experience.map(exp => `
                            <div class="mb-4">
                                <div class="flex justify-between items-baseline mb-1">
                                    <div class="font-bold text-sm text-slate-900">${exp.title || 'Job Title'}</div>
                                    <div class="text-xs text-slate-500 font-medium">${exp.duration || ''}</div>
                                </div>
                                <div class="text-xs font-semibold mb-2" style="color: ${styles.accentColor}">${exp.company || 'Company'}</div>
                                ${exp.description ? `<p class="${styles.text}">${exp.description}</p>` : ''}
                            </div>
                        `).join('')}
                    </div>
                ` : ''}

                <!-- Projects -->
                ${data.projects.length > 0 ? `
                    <div class="mb-8">
                        <h2 class="${styles.sectionTitle}" style="${template === 'classic' ? `color: ${styles.accentColor}; border-color: ${styles.accentColor};` : template === 'modern' ? `color: ${styles.accentColor};` : ''}">Projects</h2>
                        ${data.projects.map(proj => `
                            <div class="mb-5 last:mb-0">
                                <div class="flex justify-between items-baseline mb-1">
                                    <div class="font-bold text-sm text-slate-900">${proj.name || 'Untitled Project'}</div>
                                    <div class="text-[10px] text-slate-400 flex gap-2 no-print">
                                        ${proj.liveUrl ? `<a href="${proj.liveUrl}" class="hover:text-primary">Live</a>` : ''}
                                        ${proj.githubUrl ? `<a href="${proj.githubUrl}" class="hover:text-primary">GitHub</a>` : ''}
                                    </div>
                                </div>
                                ${proj.tech.length > 0 ? `<div class="text-xs italic mb-1.5 opacity-80">${proj.tech.join(', ')}</div>` : ''}
                                ${proj.description ? `<p class="${styles.text}">${proj.description}</p>` : ''}
                            </div>
                        `).join('')}
                    </div>
                ` : ''}

                <!-- Education -->
                ${data.education.length > 0 ? `
                    <div class="mb-8">
                        <h2 class="${styles.sectionTitle}" style="${template === 'classic' ? `color: ${styles.accentColor}; border-color: ${styles.accentColor};` : template === 'modern' ? `color: ${styles.accentColor};` : ''}">Education</h2>
                        ${data.education.map(edu => `
                            <div class="mb-4">
                                <div class="flex justify-between items-baseline mb-0.5">
                                    <div class="font-bold text-sm text-slate-900">${edu.degree || 'Degree'}</div>
                                    <div class="text-xs text-slate-500 font-medium">${edu.year || ''}</div>
                                </div>
                                <div class="text-xs font-medium text-slate-600">${edu.school || 'School'}</div>
                                ${edu.gpa ? `<div class="text-[10px] text-slate-400">GPA: ${edu.gpa}</div>` : ''}
                            </div>
                        `).join('')}
                    </div>
                ` : ''}
            `;

            return `
                <div class="${styles.container}" style="min-height: 11in; background: white;">
                    ${template === 'modern' ? `
                        <div class="${styles.sidebar}" style="background-color: ${styles.sidebarBg}">
                            <div class="mb-10 pt-8">
                                <div class="w-16 h-1 bg-white mb-6"></div>
                                <h2 class="text-xs font-bold uppercase tracking-widest mb-6 border-b border-white/20 pb-2">Contact</h2>
                                ${renderContactInfo()}
                            </div>
                            ${renderSkillsList(true)}
                        </div>
                        <div class="${styles.main}">
                            <div class="mb-10 pb-6 border-b border-slate-100">
                                <h1 class="${styles.name}">${data.personal.name || 'YOUR NAME'}</h1>
                                <div class="text-xs font-medium opacity-50 uppercase tracking-[0.2em]">Professional Individual</div>
                            </div>
                            ${renderMainSections()}
                        </div>
                    ` : template === 'minimal' ? `
                        <div class="p-16">
                            <div class="${styles.header}">
                                <h1 class="${styles.name}">${data.personal.name || 'YOUR NAME'}</h1>
                                <div class="flex flex-wrap gap-x-6 gap-y-2 text-xs text-slate-400">
                                    <span>${data.personal.email}</span>
                                    ${data.personal.phone ? `<span>${data.personal.phone}</span>` : ''}
                                    ${data.personal.location ? `<span>${data.personal.location}</span>` : ''}
                                </div>
                                <div class="flex gap-4 mt-4 text-[10px] font-bold uppercase tracking-widest" style="color: ${styles.accentColor}">
                                    ${data.links.github ? `<a href="#">GitHub</a>` : ''}
                                    ${data.links.linkedin ? `<a href="#">LinkedIn</a>` : ''}
                                </div>
                            </div>
                            ${renderMainSections()}
                            ${renderSkillsList()}
                        </div>
                    ` : `
                        <div class="p-14">
                            <div class="${styles.header}" style="border-color: ${styles.accentColor}">
                                <h1 class="${styles.name}">${data.personal.name || 'YOUR NAME'}</h1>
                                <div class="text-xs text-slate-600 flex justify-center flex-wrap gap-4">
                                    <span>${data.personal.email || 'email@example.com'}</span>
                                    ${data.personal.phone ? `<span>|</span><span>${data.personal.phone}</span>` : ''}
                                    ${data.personal.location ? `<span>|</span><span>${data.personal.location}</span>` : ''}
                                </div>
                                ${data.links.github || data.links.linkedin ? `
                                    <div class="text-xs text-slate-500 mt-2 flex justify-center gap-4">
                                        ${data.links.github ? `<span>${data.links.github}</span>` : ''}
                                        ${data.links.linkedin ? `<span>|</span><span>${data.links.linkedin}</span>` : ''}
                                    </div>
                                ` : ''}
                            </div>
                            ${renderMainSections()}
                            ${renderSkillsList()}
                        </div>
                    `}
                </div>
            `;
        }

        function renderResumePreview() {
            const data = getResumeData();
            const template = getTemplate();
            const themeColor = getThemeColor();

            return `
                <div class="min-h-screen flex flex-col bg-slate-50">
                    <nav class="bg-white border-b border-slate-200 px-8 py-4 no-print shadow-sm z-50">
                        <div class="max-w-7xl mx-auto flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                ${Icon('layout')}
                                <span class="font-bold text-lg">AI Resume Builder</span>
                            </div>
                            <div class="flex gap-6 text-sm font-medium">
                                <a href="#/resume/builder" class="text-slate-600 hover:text-primary transition-colors">Builder</a>
                                <a href="#/resume/preview" class="text-primary border-b-2 border-primary pb-1">Preview</a>
                                <a href="#/resume/proof" class="text-slate-600 hover:text-primary transition-colors">Proof</a>
                            </div>
                        </div>
                    </nav>

                    <style>
                        :root { --primary: ${themeColor}; }
                    </style>

                    <!-- Template Selector & Export Actions -->
                    <div class="bg-white border-b border-slate-100 px-8 py-3 no-print z-40">
                        <div class="max-w-7xl mx-auto flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <span class="text-xs font-medium text-slate-500 mr-2">Template:</span>
                                ${['classic', 'modern', 'minimal'].map(t => `
                                    <button 
                                        onclick="setTemplate('${t}')" 
                                        class="px-4 py-1.5 text-xs font-medium rounded-lg transition-colors ${template === t ? 'bg-primary text-white' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}">
                                        ${t.charAt(0).toUpperCase() + t.slice(1)}
                                    </button>
                                `).join('')}
                                
                                <div class="h-4 w-[1px] bg-slate-200 mx-2"></div>
                                
                                <div class="flex items-center gap-2">
                                    ${['hsl(168, 60%, 40%)', 'hsl(220, 60%, 35%)', 'hsl(345, 60%, 35%)', 'hsl(150, 50%, 30%)', 'hsl(0, 0%, 25%)'].map(c => `
                                        <button 
                                            onclick="setThemeColor('${c}')"
                                            class="w-5 h-5 rounded-full ring-offset-2 transition-all ${themeColor === c ? 'ring-2 ring-primary scale-110 shadow-sm' : 'hover:scale-110'}"
                                            style="background-color: ${c}"></button>
                                    `).join('')}
                                </div>
                            </div>
                            <div class="flex items-center gap-3">
                                <button onclick="copyResumeAsText()" 
                                    class="px-4 py-1.5 text-xs font-medium bg-slate-100 text-slate-600 rounded-lg hover:bg-slate-200 transition-colors flex items-center gap-1">
                                    ${Icon('copy')} Copy as Text
                                </button>
                                <button onclick="showToast('PDF export ready! Check your downloads.')" 
                                    class="px-4 py-1.5 text-xs font-medium bg-primary text-white rounded-lg hover:opacity-90 transition-colors flex items-center gap-1">
                                    ${Icon('download')} Print / Save PDF
                                </button>
                            </div>
                        </div>
                    </div>

                    ${(() => {
                    const warnings = getValidationWarnings(data);
                    return warnings.length > 0 ? `
                            <div class="bg-amber-50 border-b border-amber-100 px-8 py-3 no-print">
                                <div class="max-w-4xl mx-auto flex items-center gap-3 text-amber-700">
                                    ${Icon('alert-triangle', 'w-4 h-4')}
                                    <p class="text-xs font-medium">Your resume may look incomplete: ${warnings.join(' ')}</p>
                                </div>
                            </div>
                        ` : '';
                })()}

                    <main class="flex-1 px-8 py-12">
                        <div class="max-w-4xl mx-auto bg-white shadow-2xl overflow-hidden" style="aspect-ratio: 8.5/11;">
                            ${renderResumeContent(data, template, themeColor)}
                        </div>
                    </main>
                </div>
            `;
        }


        function renderResumeProof() {
            return `
                <div class="min-h-screen flex flex-col bg-slate-50">
                    <nav class="bg-white border-b border-slate-200 px-8 py-4">
                        <div class="max-w-7xl mx-auto flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                ${Icon('layout')}
                                <span class="font-bold text-lg">AI Resume Builder</span>
                            </div>
                            <div class="flex gap-6 text-sm font-medium">
                                <a href="#/resume/builder" class="text-slate-600 hover:text-primary transition-colors">Builder</a>
                                <a href="#/resume/preview" class="text-slate-600 hover:text-primary transition-colors">Preview</a>
                                <a href="#/resume/proof" class="text-primary border-b-2 border-primary pb-1">Proof</a>
                            </div>
                        </div>
                    </nav>

                    <main class="flex-1 max-w-4xl mx-auto px-8 py-12">
                        <div class="bg-white rounded-xl border border-slate-200 p-8">
                            <h1 class="text-2xl font-bold text-slate-900 mb-6">Proof of Work</h1>
                            <div class="text-center py-20 text-slate-400">
                                <p class="text-lg">Artifacts and submission coming soon...</p>
                            </div>
                        </div>
                    </main>
                </div>
            `;
        }

        window.addEventListener('load', render);

    </script>
</body>